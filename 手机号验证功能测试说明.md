# 手机号验证功能测试说明

## 📋 功能概述

在客户管理页面的新增客户和编辑客户功能中，已添加手机号11位格式验证。

## ✅ 已实现功能

### 1. 输入限制
- **自动过滤**：只允许输入数字，自动过滤非数字字符
- **长度限制**：最多输入11位数字
- **实时验证**：输入时实时验证格式

### 2. 格式验证
- **正则表达式**：`/^1[3-9]\d{9}$/`
- **验证规则**：
  - 必须以1开头
  - 第二位数字为3-9
  - 总共11位数字
  - 符合中国大陆手机号格式

### 3. 用户体验
- **占位符提示**：显示"请输入11位手机号码"
- **实时错误提示**：格式不正确时显示红色错误信息
- **HTML属性**：使用 `type="tel"` 和 `maxLength="11"`

## 🧪 测试步骤

### 测试环境
- 本地开发服务器：`http://localhost:5173`
- 访问路径：客户管理 → 新增客户

### 测试用例

#### 1. 正常输入测试
- **输入**：`13812345678`
- **预期结果**：✅ 正常输入，无错误提示

#### 2. 长度限制测试
- **输入**：`138123456789`（12位）
- **预期结果**：✅ 自动截取为11位：`13812345678`

#### 3. 非数字过滤测试
- **输入**：`138abc12345678`
- **预期结果**：✅ 自动过滤为：`13812345678`

#### 4. 格式验证测试
- **输入**：`12812345678`（第二位不是3-9）
- **预期结果**：❌ 显示错误提示"请输入正确的11位手机号码"

#### 5. 长度不足测试
- **输入**：`1381234567`（10位）
- **预期结果**：❌ 显示错误提示"请输入正确的11位手机号码"

#### 6. 空值测试
- **输入**：空值
- **预期结果**：❌ 提交时提示"请填写联系人姓名和电话"

## 🔧 技术实现

### 1. 输入处理函数
```javascript
const updateContact = (index, field, value) => {
  const newContacts = [...customerForm.contacts];
  
  // 如果是电话字段，添加手机号格式验证
  if (field === 'phone') {
    // 只允许输入数字，最多11位
    const phoneValue = value.replace(/\D/g, '').slice(0, 11);
    newContacts[index][field] = phoneValue;
  } else {
    newContacts[index][field] = value;
  }
  
  setCustomerForm({ ...customerForm, contacts: newContacts });
};
```

### 2. 格式验证函数
```javascript
const validatePhone = (phone) => {
  const phoneRegex = /^1[3-9]\d{9}$/;
  return phoneRegex.test(phone);
};
```

### 3. 表单验证
```javascript
// 验证手机号格式
if (!validatePhone(customerForm.contacts[0].phone)) {
  alert('请输入正确的11位手机号码');
  return;
}
```

### 4. HTML输入字段
```jsx
<input 
  type="tel" 
  className="input input-bordered" 
  value={customerForm.contacts[0].phone} 
  onChange={e => updateContact(0, 'phone', e.target.value)}
  placeholder="请输入11位手机号码"
  maxLength="11"
  pattern="[0-9]{11}"
/>
```

## 📱 支持的手机号格式

### 有效格式
- `13812345678` ✅
- `15912345678` ✅
- `18612345678` ✅
- `19912345678` ✅

### 无效格式
- `12812345678` ❌ (第二位不是3-9)
- `1381234567` ❌ (长度不足)
- `138123456789` ❌ (长度超限)
- `abc12345678` ❌ (包含非数字)

## 🚀 使用方法

1. **启动开发服务器**
   ```bash
   cd web7.27/miniprogram-admin
   npm run dev
   ```

2. **访问客户管理页面**
   - 打开浏览器访问 `http://localhost:5173`
   - 点击"客户管理"菜单
   - 点击"+ 新增客户"按钮

3. **测试手机号输入**
   - 在"电话 *"字段输入手机号
   - 观察实时验证效果
   - 尝试提交表单验证

## 📝 注意事项

1. **实时验证**：输入时立即显示错误提示
2. **自动过滤**：非数字字符会被自动过滤
3. **长度限制**：超过11位的数字会被自动截取
4. **提交验证**：提交前会再次验证格式
5. **错误提示**：格式不正确时显示明确的错误信息

---

**功能状态**: ✅ 已完成  
**测试状态**: 🧪 待测试  
**部署状态**: ⏳ 本地测试中
