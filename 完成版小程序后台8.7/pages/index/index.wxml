<!-- pages/index/index.wxml -->
<view class="page">
  <!-- 页面标题和云端同步 -->
  <view class="header-container">
    <view class="section-title">库存管理</view>
    <view class="network-status {{cloudAvailable ? 'online' : 'offline'}}">
      <view class="status-dot"></view>
      <text class="status-text">
        {{cloudAvailable ? '云端同步' : '离线模式'}}
      </text>
    </view>
  </view>
  
  <view class="nav-container">
    <view class="nav-buttons">
      <navigator url="/pages/admin/admin" class="nav-button" open-type="navigate">后台管理</navigator>
      <navigator url="/pages/records/records" class="nav-button" open-type="navigate">出入库记录</navigator>
    </view>
    <view class="last-out-time" wx:if="{{lastOutTime}}">
      <text>上次出库时间：</text>
      <view class="time-value">{{lastOutTime}}</view>
    </view>
  </view>
  
  <!-- 统计信息卡片 -->
  <view class="stats-container flex-row">
    <view class="stats-card" bindtap="navigateToTotalStock">
      <view class="stats-number">{{stats.total}}个</view>
      <view class="stats-label">SKU</view>
    </view>
    <view class="stats-card" bindtap="navigateToLowStock">
      <view class="stats-number">{{stats.lowStock}}个</view>
      <view class="stats-label">低库存</view>
    </view>
    <view class="stats-card" bindtap="navigateToCategories">
      <view class="stats-label calendar-label">出入库日历</view>
    </view>
  </view>

  <!-- 侧边栏和内容区域 -->
  <view class="main-container">
    <!-- 侧边栏分类 -->
    <view class="sidebar">
      <view 
        wx:for="{{categories}}" 
        wx:key="*this" 
        class="sidebar-item {{currentCategory === item ? 'active' : ''}}"        bindtap="switchCategory"
        data-category="{{item}}"
      >
        {{item}}
      </view>
    </view>

    <!-- 主内容区域 -->
    <view class="main-content">
      <!-- 搜索栏 -->
      <view class="search-container">
        <input class="search-input" placeholder="搜索产品名称、品牌或规格" bindinput="onSearchInput" value="{{searchKeyword}}" />
      </view>
      

      
      <!-- 品牌分类选项卡 -->
      <scroll-view scroll-x="true" class="brand-tabs" wx:if="{{brands.length > 0}}">
        <view 
          wx:for="{{brands}}" 
          wx:key="*this" 
          class="brand-tab {{currentBrand === item ? 'active' : ''}}"
          bindtap="switchBrand"
          data-brand="{{item}}"
        >
          {{item}}
        </view>
      </scroll-view>
      <!-- 睫毛二级分类选项卡 -->
      <scroll-view scroll-x="true" class="subcategory-tabs" wx:if="{{currentCategory === '睫毛'}}">
        <view 
          wx:for="{{subCategories}}" 
          wx:key="*this" 
          class="subcategory-tab {{currentSubCategory === item ? 'active' : ''}}"
          bindtap="switchSubCategory"
          data-subcategory="{{item}}"
        >
          {{item}}
        </view>
      </scroll-view>

      <!-- 产品列表 -->
      <view class="product-list">
        <block wx:if="{{products.length > 0}}">
          <view 
            class="product-item flex-row" 
            wx:for="{{products}}" 
            wx:key="id"
            bindtap="viewProductDetail"
            data-index="{{index}}"
            hover-class="item-hover"
            hover-stay-time="100"
          >
            <view class="brand-display">{{item.brand || '无品牌'}}</view>
            <view class="product-info">
              <view class="product-name">{{item.name}}</view>
              <view class="product-meta" wx:if="{{item.brand}}">品牌：{{item.brand}}</view>
              <view class="product-meta" wx:if="{{item.specification}}">规格：{{item.specification}}</view>
              <view class="product-stock {{item.stock <= 10 ? 'low-stock' : ''}}">库存：{{item.stock}}个</view>
            </view>
            <view class="take-btn">
              <button size="mini" type="primary" catchtap="takeProduct" data-index="{{index}}">领取</button>
            </view>
          </view>
        </block>
        <view wx:else class="empty-tip">暂无产品，请在后台管理中添加</view>
      </view>
    </view>
  </view>

  <!-- 自定义弹窗组件 -->
  <custom-modal 
    show="{{showModal}}"
    title="{{modalTitle}}"
    content="{{modalContent}}"
    showCancel="{{modalShowCancel}}"
    cancelText="{{modalCancelText}}"
    confirmText="{{modalConfirmText}}"
    bind:confirm="onModalConfirm"
    bind:cancel="onModalCancel"
    bind:close="onModalClose">
  </custom-modal>
</view>