<view class="container">
  <view class="loading" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
  
  <!-- å¤šæ¡è®°å½•åˆ—è¡¨æ¨¡å¼ -->
  <block wx:if="{{records.length > 0}}">
    <!-- å®¢æˆ·ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å®¢æˆ·ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">å®¢æˆ·å§“åï¼š</text>
        <text class="value">{{record.customerName}}</text>
      </view>
      <view class="info-row">
        <text class="label">è”ç³»ç”µè¯ï¼š</text>
        <text class="value">{{record.customerPhone}}</text>
      </view>
      <view class="info-row">
        <text class="label">å®¢æˆ·åœ°å€ï¼š</text>
        <text class="value">{{record.customerAddress || 'æš‚æ— åœ°å€ä¿¡æ¯'}}</text>
      </view>
    </view>
    
    <!-- æ±‡æ€»ä¿¡æ¯ -->
    <view class="section" wx:if="{{record.totalQuantity}}">
      <view class="section-title">äº§å“æ±‡æ€»</view>
      <view class="info-row">
        <text class="label">é¢„å­˜äº§å“ï¼š</text>
        <text class="value">{{record.productName}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ€»æ•°é‡ï¼š</text>
        <text class="value">{{record.totalQuantity}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ€»å‰©ä½™ï¼š</text>
        <text class="value">{{record.totalBalance}}</text>
      </view>
    </view>
    
    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="section">
      <view class="section-title">é¢„å­˜è®°å½•åˆ—è¡¨</view>
      <view class="records-list">
        <view class="record-item" wx:for="{{records}}" wx:key="_id" bindtap="viewSingleRecord" data-index="{{index}}">
          <view class="record-content">
            <view class="record-date">é¢„å­˜æ—¶é—´ï¼š{{item.createTime}}</view>
            <block wx:if="{{item.type === 'product'}}">
              <view class="record-info">äº§å“ï¼š{{item.productName}} / æ•°é‡ï¼š{{item.quantity}} / å‰©ä½™ï¼š{{item.balance}}</view>
            </block>
            <block wx:else>
              <view class="record-info">é‡‘é¢ï¼šÂ¥{{item.amount}} / å‰©ä½™ï¼šÂ¥{{item.balance}}</view>
            </block>
            <view class="record-remark" wx:if="{{item.remark}}">å¤‡æ³¨ï¼š{{item.remark}}</view>
          </view>
          <!-- åˆ é™¤æŒ‰é’® -->
          <view class="delete-record-btn" catchtap="deleteSingleRecord" data-id="{{item._id}}" data-index="{{index}}">
            <text class="delete-record-icon">ğŸ—‘</text>
          </view>
        </view>
      </view>
    </view>
  </block>
  
  <!-- å•æ¡è®°å½•è¯¦æƒ…æ¨¡å¼ -->
  <block wx:elif="{{record}}">
    <!-- å®¢æˆ·ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å®¢æˆ·ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">å®¢æˆ·å§“åï¼š</text>
        <text class="value">{{record.customerName}}</text>
      </view>
      <view class="info-row">
        <text class="label">è”ç³»ç”µè¯ï¼š</text>
        <text class="value">{{record.customerPhone}}</text>
      </view>
      <view class="info-row">
        <text class="label">å®¢æˆ·åœ°å€ï¼š</text>
        <text class="value">{{record.customerAddress || 'æš‚æ— åœ°å€ä¿¡æ¯'}}</text>
      </view>
    </view>

    <!-- é¢„å­˜ä¿¡æ¯ -->
    <view class="section">
      <view class="section-header">
        <view class="section-title">é¢„å­˜ä¿¡æ¯</view>
        <view class="delete-single-btn" catchtap="deleteSingleRecordDirect" data-id="{{record._id}}">
          <text class="delete-single-icon">ğŸ—‘</text>
        </view>
      </view>
      <block wx:if="{{record.type === 'cash'}}">
        <view class="info-row">
          <text class="label">é¢„å­˜é‡‘é¢ï¼š</text>
          <text class="value">Â¥{{record.amount}}</text>
        </view>
        <view class="info-row">
          <text class="label">å‰©ä½™é‡‘é¢ï¼š</text>
          <text class="value">Â¥{{record.balance}}</text>
        </view>
      </block>
      <block wx:else>
        <view class="info-row">
          <text class="label">é¢„å­˜äº§å“ï¼š</text>
          <text class="value">{{record.productName}}</text>
        </view>
        <view class="info-row">
          <text class="label">é¢„å­˜æ•°é‡ï¼š</text>
          <text class="value">{{record.quantity}}</text>
        </view>
        <view class="info-row">
          <text class="label">å‰©ä½™æ•°é‡ï¼š</text>
          <text class="value">{{record.balance}}</text>
        </view>
      </block>
      <view class="info-row">
        <text class="label">é¢„å­˜æ—¶é—´ï¼š</text>
        <text class="value">{{record.createTime}}</text>
      </view>
    </view>

    <!-- ä½¿ç”¨è®°å½• -->
    <view class="section">
      <view class="section-title">ä½¿ç”¨è®°å½•</view>
      <block wx:if="{{record.usageRecords && record.usageRecords.length > 0}}">
        <view class="usage-list">
          <view class="usage-item" wx:for="{{record.usageRecords}}" wx:key="index">
            <view>æ—¥æœŸæ—¶é—´ï¼š{{item.date || '-'}}</view>
            <view>äº§å“åç§°ï¼š{{item.productName || record.productName || '-'}}</view>
            <view>æ¶ˆè€—æ•°é‡ï¼š{{item.quantity || 0}}</view>
            <view wx:if="{{item.receiver}}">æ”¶è´§äººï¼š{{item.receiver}}</view>
            <view wx:if="{{item.phone}}">æ”¶è´§ç”µè¯ï¼š{{item.phone}}</view>
            <view wx:if="{{item.address}}">æ”¶è´§åœ°å€ï¼š{{item.address.detail || item.address}}</view>
            <view>
              è®¢å•ç¼–å·ï¼š<text class="order-link" data-id="{{item.orderId}}" bindtap="goOrderDetail">{{item.orderNo || item.orderId}}</text>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-tip" wx:else>æš‚æ— ä½¿ç”¨è®°å½•</view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="section" wx:if="{{record.remark}}">
      <view class="section-title">å¤‡æ³¨</view>
      <view class="remark">{{record.remark}}</view>
    </view>
  </block>
</view> 