<!-- pages/members/members.wxml -->
<view class="container">
  <view class="section-title">å®¢æˆ·é¢„å­˜è®°å½•</view>
  
  <!-- æœç´¢å’Œæ·»åŠ è®°å½• -->
  <view class="action-bar">
    <view class="search-box">
      <input 
        type="text" 
        placeholder="æœç´¢å®¢æˆ·å§“åæˆ–æ‰‹æœºå·" 
        value="{{searchValue}}" 
        bindinput="searchRecords"
        confirm-type="search"
      />
    </view>
    <view class="add-btn" bindtap="addRecord" hover-class="btn-hover">
      <text class="add-icon">+</text>
    </view>

    <!-- åˆ·æ–°æŒ‰é’® -->
    <view class="refresh-btn" bindtap="refreshRecords" hover-class="btn-hover">
      <text class="refresh-icon">âŸ³</text>
    </view>
  </view>
  

  
  <!-- åˆ†ç»„åçš„é¢„å­˜è®°å½•åˆ—è¡¨ -->
  <view class="record-list" wx:if="{{!loading}}">
    <view class="debug-info" wx:if="{{groupedRecords.length > 0}}">
      <text>æ‰¾åˆ° {{groupedRecords.length}} æ¡åˆ†ç»„è®°å½•</text>
    </view>
    <block wx:for="{{groupedRecords}}" wx:key="customerPhone">
      <view class="record-item" 
            bindtap="viewCustomerRecords" 
            data-phone="{{item.customerPhone}}">
        
        <view class="record-content">
        <view class="record-header">
          <view class="customer-info">
            <text class="customer-name">{{item.customerName}}</text>
            <text class="customer-phone">{{item.customerPhone}}</text>
          </view>
          <view class="record-time">
            <text class="time-label">æœ€è¿‘é¢„å­˜ï¼š</text>
            <text>{{item.latestTime}}</text>
          </view>
        </view>
        

          
          <!-- è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘æ—¶å¯æ˜¾ç¤ºï¼‰ -->
          <!-- <view class="debug-info">
            <text>ç±»å‹: {{item.hasMultipleTypes ? 'æ··åˆ' : (item.cashAmount > 0 ? 'cash' : 'product')}} | è®°å½•æ•°: {{item.records.length}}</text>
          </view> -->
          
          <!-- ç°é‡‘é¢„å­˜ä¿¡æ¯ -->
          <block wx:if="{{item.cashAmount > 0}}">
            <view class="prestore-section cash-section">
              <view class="section-header">
                <text class="section-title">ğŸ’° é‡‘é¢é¢„å­˜</text>
              </view>
              <view class="info-row">
                <text class="label">é¢„å­˜é‡‘é¢ï¼š</text>
                <text class="value amount-value">Â¥{{item.cashAmount}}</text>
              </view>
              <view class="info-row">
                <text class="label">è®°å½•æ•°ï¼š</text>
                <text class="value">{{item.cashRecords.length}}æ¡</text>
              </view>
            </view>
          </block>
          
          <!-- äº§å“é¢„å­˜ä¿¡æ¯ -->
          <block wx:if="{{item.productSummaryArray.length > 0}}">
            <block wx:for="{{item.productSummaryArray}}" wx:for-item="product" wx:key="productName">
              <view class="prestore-section product-section">
                <view class="section-header">
                  <text class="section-title">ğŸ“¦ {{product.productName}}</text>
                </view>
                <view class="info-row">
                  <text class="label">æ€»æ•°é‡ï¼š</text>
                  <text class="value quantity-value">{{product.totalQuantity}}</text>
                </view>
                <view class="info-row">
                  <text class="label">æ€»å‰©ä½™ï¼š</text>
                  <text class="value balance-value">{{product.totalBalance}}</text>
                </view>
                <view class="info-row">
                  <text class="label">è®°å½•æ•°ï¼š</text>
                  <text class="value">{{product.recordCount}}æ¡</text>
                </view>
              </view>
            </block>
          </block>
          <view class="records-count">
            <text>å…±{{item.records.length}}æ¡è®°å½• ></text>
          </view>
        </view>
      </view>
    </block>
  </view>
  
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && groupedRecords.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-title">æš‚æ— é¢„å­˜è®°å½•</view>
    <view class="empty-desc">ç‚¹å‡»å³ä¸Šè§’"+"æŒ‰é’®æ·»åŠ å®¢æˆ·é¢„å­˜è®°å½•</view>
    <view class="empty-action">
      <view class="empty-btn" bindtap="addRecord">ç«‹å³æ·»åŠ </view>
    </view>
  </view>
  

</view>