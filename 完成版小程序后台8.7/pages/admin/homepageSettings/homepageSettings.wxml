<!-- pages/admin/homepageSettings/homepageSettings.wxml -->
<view class="container">
  <!-- 页面头部 -->
  <view class="header">
    <view class="title">首页设置</view>
    <view class="subtitle">管理首页轮播图和推广内容</view>
  </view>

  <!-- 主要内容区域 -->
  <scroll-view scroll-y="true" class="main-content">
    <!-- 轮播图管理 -->
    <view class="section">
      <view class="section-title">
        <text>轮播图管理</text>
        <button class="btn btn-primary" bindtap="addCarouselImage">添加轮播图</button>
      </view>
      
      <view class="carousel-list" wx:if="{{carouselImages.length > 0}}">
        <view wx:for="{{carouselImages}}" wx:key="_id" class="carousel-item">
          <view class="carousel-preview">
            <image src="{{item.imageUrl || '/images/placeholder.png'}}" class="preview-image" mode="aspectFill" />
            <view class="gradient-overlay" style="background: {{item.gradient}}"></view>
          </view>
          <view class="carousel-info">
            <view class="info-row">
              <text class="label">标题:</text>
              <text class="value">{{item.title || '未设置'}}</text>
            </view>
            <view class="info-row">
              <text class="label">副标题:</text>
              <text class="value">{{item.subtitle || '未设置'}}</text>
            </view>
            <view class="info-row">
              <text class="label">状态:</text>
              <text class="value {{item.status === 'active' ? 'status-active' : 'status-inactive'}}">
                {{item.status === 'active' ? '启用' : '禁用'}}
              </text>
            </view>
            <view class="info-row">
              <text class="label">排序:</text>
              <text class="value">{{item.sort || 0}}</text>
            </view>
          </view>
          <view class="carousel-actions">
            <button class="btn btn-small btn-secondary" bindtap="editCarouselItem" data-item="{{item}}">编辑</button>
            <button class="btn btn-small btn-danger" bindtap="deleteCarouselItem" data-id="{{item._id}}">删除</button>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-state">
        <text>暂无轮播图，请添加</text>
      </view>
    </view>

    <!-- 推广内容管理 -->
    <view class="section">
      <view class="section-title">
        <text>推广内容设置</text>
        <button class="btn btn-primary" bindtap="editPromoContent">编辑内容</button>
      </view>
      
      <view class="promo-preview">
        <view class="promo-item">
          <text class="promo-label">主标题:</text>
          <text class="promo-value">{{promoData.title}}</text>
        </view>
        <view class="promo-item">
          <text class="promo-label">副标题:</text>
          <text class="promo-value">{{promoData.subtitle}}</text>
        </view>
        <view class="promo-item">
          <text class="promo-label">优惠信息:</text>
          <text class="promo-value">{{promoData.giftNote}}</text>
        </view>
        <view class="promo-item">
          <text class="promo-label">有效期说明:</text>
          <text class="promo-value">{{promoData.validityNote}}</text>
        </view>
        <view class="promo-item">
          <text class="promo-label">价格信息:</text>
          <view class="price-list">
            <text wx:for="{{promoData.prices}}" wx:key="index" class="price-tag">
              ￥{{item.price}} (原价￥{{item.originalPrice}})
            </text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 轮播图编辑弹窗 -->
  <view class="modal {{showCarouselModal ? 'show' : ''}}" catchtouchstart="closeModal">
    <view class="modal-content" catchtouchstart="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{isEditMode ? '编辑' : '添加'}}轮播图</text>
        <text class="modal-close" bindtap="closeModal">×</text>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">标题</text>
          <input class="form-input" placeholder="请输入标题" value="{{currentCarousel.title}}" bindinput="onCarouselTitleInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">副标题</text>
          <input class="form-input" placeholder="请输入副标题" value="{{currentCarousel.subtitle}}" bindinput="onCarouselSubtitleInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">图片</text>
          <view class="image-upload-container">
            <image wx:if="{{currentCarousel.imageUrl}}" src="{{currentCarousel.imageUrl}}" class="upload-preview" mode="aspectFill" />
            <view wx:else class="upload-placeholder" bindtap="selectCarouselImage">
              <text>点击选择图片</text>
            </view>
            <button wx:if="{{currentCarousel.imageUrl}}" class="btn btn-small btn-secondary" bindtap="selectCarouselImage">更换图片</button>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">渐变色</text>
          <picker mode="selector" range="{{gradientOptions}}" range-key="name" value="{{currentCarousel.gradientIndex}}" bindchange="onGradientChange">
            <view class="picker-display">
              <text>{{gradientOptions[currentCarousel.gradientIndex || 0].name}}</text>
              <view class="gradient-preview" style="background: {{currentCarousel.gradient}}"></view>
            </view>
          </picker>
        </view>
        
        <view class="form-group">
          <text class="form-label">排序</text>
          <input class="form-input" type="number" placeholder="数字越小越靠前" value="{{currentCarousel.sort}}" bindinput="onCarouselSortInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">状态</text>
          <switch checked="{{currentCarousel.status === 'active'}}" bindchange="onCarouselStatusChange" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closeModal">取消</button>
        <button class="btn btn-primary" bindtap="saveCarouselItem">保存</button>
      </view>
    </view>
  </view>

  <!-- 推广内容编辑弹窗 -->
  <view class="modal {{showPromoModal ? 'show' : ''}}" catchtouchstart="closePromoModal">
    <view class="modal-content" catchtouchstart="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">编辑推广内容</text>
        <text class="modal-close" bindtap="closePromoModal">×</text>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">主标题</text>
          <input class="form-input" placeholder="请输入主标题" value="{{editingPromo.title}}" bindinput="onPromoTitleInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">副标题</text>
          <input class="form-input" placeholder="请输入副标题" value="{{editingPromo.subtitle}}" bindinput="onPromoSubtitleInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">优惠信息</text>
          <input class="form-input" placeholder="请输入优惠信息" value="{{editingPromo.giftNote}}" bindinput="onPromoGiftNoteInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">有效期说明</text>
          <textarea class="form-textarea" placeholder="请输入有效期说明" value="{{editingPromo.validityNote}}" bindinput="onPromoValidityNoteInput"></textarea>
        </view>
        
        <view class="form-group">
          <text class="form-label">价格设置</text>
          <view class="price-settings">
            <view wx:for="{{editingPromo.prices}}" wx:key="index" class="price-setting-item">
              <input class="price-input" type="digit" placeholder="价格" value="{{item.price}}" bindinput="onPriceInput" data-index="{{index}}" data-field="price" />
              <text class="price-separator">原价</text>
              <input class="price-input" type="digit" placeholder="原价" value="{{item.originalPrice}}" bindinput="onPriceInput" data-index="{{index}}" data-field="originalPrice" />
              <button class="btn btn-small btn-danger" bindtap="removePriceItem" data-index="{{index}}">删除</button>
            </view>
            <button class="btn btn-small btn-secondary" bindtap="addPriceItem">添加价格</button>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closePromoModal">取消</button>
        <button class="btn btn-primary" bindtap="savePromoContent">保存</button>
      </view>
    </view>
  </view>
</view> 