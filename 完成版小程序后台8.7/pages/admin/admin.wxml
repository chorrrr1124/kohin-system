<!-- pages/admin/admin.wxml -->
<view class="page">
  <!-- å›ºå®šå¤´éƒ¨åŒºåŸŸ -->
  <view class="header-container">
    <view class="section-title">åå°ç®¡ç†</view>
    <view class="nav-buttons">
      <navigator url="/pages/index/index" class="nav-button" open-type="reLaunch">åº“å­˜ç®¡ç†</navigator>
      <navigator url="/pages/records/records" class="nav-button" open-type="navigate">å‡ºå…¥åº“è®°å½•</navigator>
      <view class="nav-button logout-button" bindtap="logout">é€€å‡ºç™»å½•</view>
    </view>
    <view class="last-out-time" wx:if="{{lastOutTime}}">ä¸Šæ¬¡å‡ºåº“æ—¶é—´ï¼š{{lastOutTime}}</view>
  </view>

  <!-- å›ºå®šç»Ÿè®¡å’Œæ“ä½œåŒºåŸŸ -->
  <view class="fixed-stats-container">
    <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="stats-container flex-row">
      <view class="stats-card" bindtap="navigateToTotalStock">
        <view class="stats-number">{{stats.total}}ä¸ª</view>
        <view class="stats-label">SKU</view>
      </view>
      <view class="stats-card" bindtap="navigateToLowStock">
        <view class="stats-number">{{stats.lowStock}}ä¸ª</view>
        <view class="stats-label">ä½åº“å­˜</view>
      </view>
      <view class="stats-card" bindtap="navigateToCalendar">
        <view class="stats-number">{{stats.categoryCount}}ä¸ª</view>
        <view class="stats-label">å‡ºå…¥åº“æ—¥å†</view>
      </view>
    </view>

    <!-- å‡ºå…¥åº“ç®¡ç†å’Œæ·»åŠ äº§å“æŒ‰é’® -->
    <view class="action-buttons">
      <view class="action-button" bindtap="navigateToProductIn">
        <view class="action-icon">ğŸ“¥</view>
        <view class="action-label">äº§å“å…¥åº“</view>
      </view>
      <view class="action-button add-product" bindtap="navigateToAddProduct">
        <view class="action-icon">â•</view>
        <view class="action-label">æ·»åŠ äº§å“</view>
      </view>
      <view class="action-button homepage-settings" bindtap="navigateToHomepageSettings">
        <view class="action-icon">ğŸ </view>
        <view class="action-label">é¦–é¡µè®¾ç½®</view>
      </view>
    </view>
  </view>

  <!-- å›ºå®šæœç´¢å’Œé€‰é¡¹å¡åŒºåŸŸ -->
  <view class="fixed-search-container">
    <!-- æœç´¢æ  -->
    <view class="search-container">
      <input class="search-input" placeholder="æœç´¢äº§å“åç§°ã€å“ç‰Œæˆ–è§„æ ¼" bindinput="onSearchInput" value="{{searchKeyword}}" />
    </view>
    
    <!-- å“ç‰Œåˆ†ç±»é€‰é¡¹å¡ -->
    <scroll-view scroll-x="true" class="brand-tabs" wx:if="{{brands.length > 0}}">
      <view 
        wx:for="{{brands}}" 
        wx:key="*this" 
        class="brand-tab {{currentBrand === item ? 'active' : ''}}"
        bindtap="switchBrand"
        data-brand="{{item}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- ä¸»å®¹å™¨åŒºåŸŸ -->
  <view class="main-container">
    <!-- ä¾§è¾¹æ åˆ†ç±» -->
    <view class="sidebar">
      <view 
        wx:for="{{categories}}" 
        wx:key="*this" 
        class="sidebar-item {{currentCategory === item ? 'active' : ''}}"
        bindtap="switchCategory"
        data-category="{{item}}"
      >
        {{item}}
      </view>
    </view>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <view class="main-content">
      <!-- äº§å“åˆ—è¡¨ -->
      <view class="product-list">
        <block wx:if="{{products.length > 0}}">
          <view 
            class="product-item flex-row" 
            wx:for="{{products}}" 
            wx:key="id"
            bindtap="viewProductDetail"
            data-index="{{index}}"
          >
            <image class="product-image" src="{{item.imagePath || '/images/placeholder.png'}}"></image>
            <view class="product-info">
              <view class="product-name">{{item.name}}</view>
              <view class="product-meta" wx:if="{{item.brand}}">å“ç‰Œï¼š{{item.brand}}</view>
              <view class="product-meta" wx:if="{{item.specification}}">è§„æ ¼ï¼š{{item.specification}}</view>
              <view class="product-stock {{item.stock <= 10 ? 'low-stock' : ''}}">åº“å­˜ï¼š{{item.stock}}ä¸ª</view>
            </view>
            <view class="admin-actions">
              <button size="mini" type="primary" catchtap="editProduct" data-index="{{index}}">ç¼–è¾‘</button>
              <button size="mini" type="warn" catchtap="deleteProduct" data-index="{{index}}">åˆ é™¤</button>
            </view>
          </view>
        </block>
        <view wx:else class="empty-tip">æš‚æ— äº§å“ï¼Œè¯·æ·»åŠ äº§å“</view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰å¼¹çª—ç»„ä»¶ -->
  <custom-modal 
    show="{{showModal}}" 
    title="{{modalTitle}}" 
    content="{{modalContent}}" 
    show-cancel="{{showCancel}}"
    bind:confirm="onModalConfirm"
    bind:cancel="onModalCancel"
    bind:close="onModalClose"
  ></custom-modal>
</view>