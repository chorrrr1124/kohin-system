<!--pages/admin/products/products.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">产品管理</view>
    <view class="page-subtitle">管理所有产品信息</view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-container">
    <input 
      class="search-input" 
      placeholder="搜索产品名称、品牌或规格" 
      bindinput="onSearchInput" 
      value="{{searchKeyword}}"
    />
    <view class="search-icon">🔍</view>
  </view>

  <!-- 统计信息 -->
  <view class="stats-container">
    <view class="stats-item">
      <view class="stats-number">{{products.length}}</view>
      <view class="stats-label">总产品数</view>
    </view>
    <view class="stats-item">
      <view class="stats-number">{{lowStockCount}}</view>
      <view class="stats-label">低库存</view>
    </view>
  </view>

  <!-- 产品列表 -->
  <view class="product-list">
    <block wx:if="{{products.length > 0}}">
      <view 
        class="product-item" 
        wx:for="{{products}}" 
        wx:key="id"
        bindtap="viewProductDetail"
        data-product="{{item}}"
      >
        <!-- 产品图片 -->
        <image 
          class="product-image" 
          src="{{item.imagePath || '/images/placeholder.png'}}"
          mode="aspectFill"
        ></image>
        
        <!-- 产品信息 -->
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-meta" wx:if="{{item.brand}}">
            <text class="meta-label">品牌：</text>
            <text class="meta-value">{{item.brand}}</text>
          </view>
          <view class="product-meta" wx:if="{{item.specification}}">
            <text class="meta-label">规格：</text>
            <text class="meta-value">{{item.specification}}</text>
          </view>
          <view class="product-meta">
            <text class="meta-label">价格：</text>
            <text class="meta-value price">¥{{item.price}}</text>
          </view>
          <view class="product-meta">
            <text class="meta-label">库存：</text>
            <text class="meta-value stock {{item.stock <= 10 ? 'low-stock' : ''}}">
              {{item.stock}}个
            </text>
          </view>
        </view>
        
        <!-- 操作按钮 -->
        <view class="product-actions">
          <button 
            class="action-btn edit-btn" 
            size="mini" 
            type="primary" 
            catchtap="editProduct" 
            data-product="{{item}}"
          >
            编辑
          </button>
          <button 
            class="action-btn delete-btn" 
            size="mini" 
            type="warn" 
            catchtap="deleteProduct" 
            data-id="{{item._id}}"
          >
            删除
          </button>
        </view>
      </view>
    </block>
    
    <!-- 空状态 -->
    <view wx:else class="empty-state">
      <view class="empty-icon">📦</view>
      <view class="empty-text">暂无产品</view>
      <view class="empty-subtext">请先添加一些产品</view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <!-- 删除确认弹窗 -->
  <view wx:if="{{showDeleteModal}}" class="modal-overlay" bindtap="hideDeleteModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">确认删除</view>
      </view>
      <view class="modal-body">
        <view class="modal-message">确定要删除这个产品吗？</view>
        <view class="modal-product-info">
          <text class="product-name">{{deleteProductName}}</text>
        </view>
        <view class="modal-warning">⚠️ 删除后无法恢复</view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideDeleteModal">取消</button>
        <button class="modal-btn confirm-btn" bindtap="confirmDelete">确认删除</button>
      </view>
    </view>
  </view>
</view>