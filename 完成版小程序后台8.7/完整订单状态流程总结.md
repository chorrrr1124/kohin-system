## ✅ 订单状态流程重新完善！

### 🔄 新的完整订单状态流程

#### 📊 状态定义（4种状态）
1. **pending** - 待付款
2. **pending_shipment** - 待发货  
3. **shipped** - 已发货
4. **completed** - 已完成

#### 🎯 初始状态规则
- **现金支付/微信支付/预存抵扣**: pending（待付款）
- **预存扣除**: pending_shipment（待发货）

#### 🔄 状态流转图

```
现金支付/微信支付/预存抵扣订单:
pending → pending_shipment → shipped → completed
(待付款)    (待发货)        (已发货)   (已完成)

预存扣除订单:
pending_shipment → shipped → completed
    (待发货)      (已发货)   (已完成)
```

### 🔧 修改内容

#### 1️⃣ **状态定义完善**
- `pages/orders/orders.js`: 重新添加"已发货"选项卡
- `pages/orders/orderDetail/orderDetail.js`: 添加shipped状态文本
- `pages/orders/addOrder/addOrder.js`: 添加shipped到状态列表
- `pages/customers/customerDetail/customerDetail.js`: 添加shipped状态文本

#### 2️⃣ **状态流转逻辑**
- `pages/orders/orderDetail/orderDetail.js`: 更新两处状态流转
  - pending → pending_shipment → shipped → completed
- `pages/orders/orders.js`: 更新状态变更逻辑

#### 3️⃣ **界面文本完善**
- `pages/orders/orders.wxml`: 添加shipped状态显示和按钮文本
- `pages/orders/orderDetail/orderDetail.wxml`: 完善按钮文本

#### 4️⃣ **预存产品扣减优化**
- 扣减时机：从 `shipped → completed` 时扣减
- "直接扣减预存"按钮：在shipped状态时显示

### 📱 用户操作流程

#### 💰 现金支付/微信支付/预存抵扣订单
1. **下单** → 待付款
2. **确认付款** → 待发货
3. **发货** → 已发货
4. **确认完成** → 已完成

#### 🎁 预存扣除订单
1. **下单** → 待发货（直接跳过付款）
2. **发货** → 已发货
3. **确认完成** → 已完成（此时扣减预存产品）

### 🎯 关键特性

#### ⚡ **智能路由**
- 根据支付方式自动设置合适的初始状态
- 预存扣除直接跳过付款环节

#### 🔄 **完整流程**
- 4个状态涵盖完整的订单生命周期
- 清晰的状态流转和操作提示

#### 📦 **预存管理**
- 在订单真正完成时才扣减预存产品
- 支持手动扣减预存产品功能

#### 🎨 **用户体验**
- 状态一目了然，操作步骤清晰
- 不同支付方式有不同的流程优化

### 📋 按钮文本对照

| 订单状态 | 主要按钮 | 次要按钮 |
|---------|---------|---------|
| 待付款 | 标记为待发货 | 确认付款 |
| 待发货 | 标记为已发货 | 发货 |
| 已发货 | 标记为已完成 | 确认完成 |
| 已完成 | - | - |

现在订单状态流程更加完整和规范，既保持了操作的简洁性，又确保了业务流程的完整性！


