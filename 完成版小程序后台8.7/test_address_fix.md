# 地址重复和选择问题修复方案

## 🔍 问题分析

### 1. 重复联系人问题
- **原因**: 地址列表页面每次 `onShow` 都会重新加载数据
- **原因**: 从联系人创建地址时没有去重逻辑
- **原因**: 购物车页面遍历所有联系人时没有去重

### 2. 地址选择后未正确填充到购物车
- **原因**: 事件通道可能不可用或监听器不匹配
- **原因**: 缺少全局事件监听机制

## ✅ 修复方案

### 1. 地址列表页面修复
- ✅ 修改 `onShow` 方法，避免重复加载
- ✅ 添加联系人去重逻辑，使用 `Set` 存储已处理的电话号码
- ✅ 遍历所有联系人创建地址，而不是只取第一个
- ✅ 改进临时地址的默认选中逻辑

### 2. 购物车页面修复
- ✅ 添加联系人去重逻辑
- ✅ 增加多个事件监听器 (`selectAddress`, `addressSelected`)
- ✅ 设置全局地址选择监听器
- ✅ 改进地址选择后的UI更新逻辑

### 3. 事件传递机制改进
- ✅ 使用事件通道传递地址数据
- ✅ 添加全局变量作为备用传递方式
- ✅ 使用本地存储作为最终备用方案
- ✅ 触发全局事件监听器

## 🧪 测试步骤

1. **测试重复联系人问题**:
   - 进入购物车页面
   - 选择客户
   - 点击收货地址
   - 检查是否还有重复的联系人

2. **测试地址选择功能**:
   - 在地址列表页面选择地址
   - 返回购物车页面
   - 检查收货地址是否正确更新

3. **测试新增地址功能**:
   - 在地址列表页面新增地址
   - 选择新地址
   - 检查是否正确填充到购物车

## 📝 修改的文件

1. `pages/addressList/addressList.js` - 地址列表页面逻辑
2. `pages/cart/cart.js` - 购物车页面逻辑

## 🎯 预期效果

- ✅ 不再出现重复的联系人
- ✅ 地址选择后能正确填充到购物车页面
- ✅ 新增地址后能正确传递到购物车
- ✅ 界面显示更加稳定和一致 