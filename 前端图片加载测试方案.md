# å‰ç«¯å›¾ç‰‡åŠ è½½æµ‹è¯•æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡æ’æŸ¥å‘ç°ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š

### 1. æ•°æ®åº“é›†åˆä¸åŒ¹é…
- **å‰ç«¯æŸ¥è¯¢**: `images` é›†åˆ
- **äº‘å‡½æ•°ä¿å­˜**: `cloudImages` é›†åˆ

### 2. äº‘å‡½æ•°æ‰¹é‡æ“ä½œé”™è¯¯
- **é”™è¯¯**: `db.startBatch is not a function`
- **åŸå› **: CloudBase æ‰¹é‡æ“ä½œè¯­æ³•ä¸æ­£ç¡®

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. ä¿®æ”¹äº‘å‡½æ•°ä¿å­˜é›†åˆ
```javascript
// ä¿®æ”¹å‰
db.collection('cloudImages').add({...})

// ä¿®æ”¹å  
db.collection('images').add({...})
```

### 2. ä¿®å¤æ‰¹é‡æ“ä½œ
```javascript
// ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
const batch = db.startBatch();
batch.add(...);
await batch.commit();

// ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
for (const image of images) {
  await db.collection('images').add({...});
}
```

### 3. æ·»åŠ å‰ç«¯å…¼å®¹å­—æ®µ
```javascript
{
  // åŸæœ‰å­—æ®µ
  cloudPath: image.cloudPath,
  url: image.url,
  fileName: image.fileName,
  category: category,
  
  // å…¼å®¹å‰ç«¯å­—æ®µ
  sortOrder: image.displayOrder || image.sortOrder || 0,
  title: image.title || image.fileName,
  imageUrl: image.url,
  linkUrl: image.linkUrl || '',
  isActive: image.isActive !== undefined ? image.isActive : true
}
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ–¹æ³•1: ä½¿ç”¨äº‘å‡½æ•°æµ‹è¯•ï¼ˆæ¨èï¼‰

1. **ä¿å­˜æµ‹è¯•æ•°æ®**ï¼š
```javascript
// åœ¨å°ç¨‹åºæˆ–Webç«¯æ‰§è¡Œ
wx.cloud.callFunction({
  name: 'cloudStorageManager',
  data: {
    action: 'saveImageInfo',
    data: {
      images: [{
        cloudPath: 'images/banner/test-banner.jpg',
        url: 'https://636c-cloudbase-3g4w6lls8a5ce59b-1327524326.tcb.qcloud.la/images/banner/test-banner.jpg',
        fileName: 'test-banner.jpg',
        category: 'banner',
        displayOrder: 1,
        title: 'æµ‹è¯•è½®æ’­å›¾',
        linkUrl: 'https://example.com'
      }],
      category: 'banner'
    }
  }
}).then(res => {
  console.log('ä¿å­˜ç»“æœ:', res.result);
});
```

2. **æŸ¥è¯¢æµ‹è¯•æ•°æ®**ï¼š
```javascript
// æŸ¥è¯¢è½®æ’­å›¾
wx.cloud.callFunction({
  name: 'cloudStorageManager',
  data: {
    action: 'getImageList',
    data: {
      category: 'banner'
    }
  }
}).then(res => {
  console.log('æŸ¥è¯¢ç»“æœ:', res.result);
  console.log('å›¾ç‰‡æ•°é‡:', res.result.data ? res.result.data.length : 0);
});
```

### æ–¹æ³•2: ç›´æ¥æŸ¥è¯¢æ•°æ®åº“

```javascript
// ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
const db = wx.cloud.database();
db.collection('images')
  .where({
    category: 'banner'
  })
  .orderBy('sortOrder', 'asc')
  .get()
  .then(res => {
    console.log('ç›´æ¥æŸ¥è¯¢ç»“æœ:', res);
    console.log('å›¾ç‰‡æ•°é‡:', res.data.length);
  });
```

## ğŸ”§ å‰ç«¯ä»£ç æ£€æŸ¥

### æ£€æŸ¥å›¾ç‰‡ç®¡ç†é¡µé¢

1. **ç¡®è®¤æŸ¥è¯¢é›†åˆ**ï¼š
```javascript
// åº”è¯¥æ˜¯ images é›†åˆ
const result = await db.collection('images')
  .where('category', '==', activeTab)
  .orderBy('sortOrder', 'asc')
  .get();
```

2. **ç¡®è®¤å­—æ®µæ˜ å°„**ï¼š
```javascript
// ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå
{
  sortOrder: image.sortOrder,  // ä¸æ˜¯ displayOrder
  title: image.title,          // ä¸æ˜¯ fileName
  imageUrl: image.imageUrl,    // ä¸æ˜¯ url
  linkUrl: image.linkUrl,
  isActive: image.isActive
}
```

## ğŸ“‹ éªŒè¯æ¸…å•

- [ ] äº‘å‡½æ•°å·²é‡æ–°éƒ¨ç½²
- [ ] ä¿å­˜åˆ° `images` é›†åˆ
- [ ] åŒ…å«å‰ç«¯å…¼å®¹å­—æ®µ
- [ ] å‰ç«¯æŸ¥è¯¢ `images` é›†åˆ
- [ ] å­—æ®µååŒ¹é…æ­£ç¡®
- [ ] å›¾ç‰‡ç®¡ç†é¡µé¢èƒ½æ­£å¸¸åŠ è½½

## ğŸš€ å¿«é€Ÿä¿®å¤

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥å°è¯•ï¼š

1. **æ¸…ç†æµè§ˆå™¨ç¼“å­˜**
2. **é‡æ–°ç¼–è¯‘å°ç¨‹åº**
3. **æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—**
4. **ç¡®è®¤æ•°æ®åº“æƒé™**

## ğŸ“ ä¸‹ä¸€æ­¥

1. é‡æ–°éƒ¨ç½²äº‘å‡½æ•°
2. åœ¨å‰ç«¯æµ‹è¯•ä¿å­˜å’ŒæŸ¥è¯¢
3. æ£€æŸ¥å›¾ç‰‡ç®¡ç†é¡µé¢æ˜¾ç¤º
4. éªŒè¯è½®æ’­å›¾åŠŸèƒ½

---

**çŠ¶æ€**: ğŸ”§ å·²ä¿®å¤ä»£ç ï¼Œç­‰å¾…éƒ¨ç½²æµ‹è¯•
**ä¼˜å…ˆçº§**: é«˜
**é¢„è®¡è§£å†³æ—¶é—´**: 5åˆ†é’Ÿ
