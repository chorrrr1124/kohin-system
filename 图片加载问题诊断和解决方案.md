# å›¾ç‰‡åŠ è½½é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ç°è±¡
- å›¾ç‰‡ä¿å­˜æˆåŠŸï¼Œä½†å‰ç«¯ç•Œé¢æ˜¾ç¤º"å½“å‰åˆ†ç±»: è½®æ’­å›¾ (0å¼ )"
- å›¾ç‰‡ç®¡ç†ç•Œé¢æ— æ³•åŠ è½½å‡ºå·²ä¿å­˜çš„å›¾ç‰‡

### æ ¹æœ¬åŸå› 
**æ•°æ®åº“é›†åˆä¸åŒ¹é…**ï¼š
- å‰ç«¯ä»£ç æŸ¥è¯¢ï¼š`images` é›†åˆ
- äº‘å‡½æ•°ä¿å­˜åˆ°ï¼š`cloudImages` é›†åˆ

### å…·ä½“åˆ†æ

#### 1. å‰ç«¯æŸ¥è¯¢ä»£ç 
```javascript
// web7.27/miniprogram-admin/src/pages/ImageManagePage.jsx
const result = await db.collection('images')  // âŒ æŸ¥è¯¢ images é›†åˆ
  .where('category', '==', activeTab)
  .orderBy('sortOrder', 'asc')
  .get();
```

#### 2. äº‘å‡½æ•°ä¿å­˜ä»£ç 
```javascript
// cloudfunctions/cloudStorageManager/index.js
batch.add(db.collection('cloudImages').add({  // âŒ ä¿å­˜åˆ° cloudImages é›†åˆ
  data: { ... }
}));
```

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®æ”¹äº‘å‡½æ•°ï¼ˆæ¨èï¼‰
å°†äº‘å‡½æ•°ä¿®æ”¹ä¸ºä¿å­˜åˆ° `images` é›†åˆï¼Œå¹¶å…¼å®¹å‰ç«¯å­—æ®µæ ¼å¼ã€‚

#### å·²å®Œæˆçš„ä¿®æ”¹ï¼š

1. **ä¿®æ”¹ä¿å­˜é›†åˆ**ï¼š`cloudImages` â†’ `images`
2. **æ·»åŠ å…¼å®¹å­—æ®µ**ï¼š
   ```javascript
   {
     // åŸæœ‰å­—æ®µ
     cloudPath: image.cloudPath,
     url: image.url,
     fileName: image.fileName,
     category: category,
     
     // å…¼å®¹å‰ç«¯å­—æ®µ
     sortOrder: image.displayOrder || image.sortOrder || 0,
     title: image.title || image.fileName,
     imageUrl: image.url,
     linkUrl: image.linkUrl || '',
     isActive: image.isActive !== undefined ? image.isActive : true
   }
   ```

3. **ä¿®æ”¹æŸ¥è¯¢å­—æ®µ**ï¼š`displayOrder` â†’ `sortOrder`

### æ–¹æ¡ˆ2ï¼šä¿®æ”¹å‰ç«¯ä»£ç 
å°†å‰ç«¯ä»£ç ä¿®æ”¹ä¸ºä½¿ç”¨äº‘å‡½æ•°æŸ¥è¯¢ã€‚

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. é‡æ–°éƒ¨ç½²äº‘å‡½æ•°
```bash
cd cloudfunctions
tcb fn deploy cloudStorageManager --dir ./cloudStorageManager
```

### 2. æµ‹è¯•ä¿å­˜åŠŸèƒ½
```javascript
// æµ‹è¯•ä¿å­˜è½®æ’­å›¾
const result = await wx.cloud.callFunction({
  name: 'cloudStorageManager',
  data: {
    action: 'saveImageInfo',
    data: {
      images: [{
        cloudPath: 'images/banner/test-banner.jpg',
        url: 'https://636c-cloudbase-3g4w6lls8a5ce59b-1327524326.tcb.qcloud.la/images/banner/test-banner.jpg',
        fileName: 'test-banner.jpg',
        category: 'banner',
        displayOrder: 1,
        title: 'æµ‹è¯•è½®æ’­å›¾',
        linkUrl: 'https://example.com'
      }],
      category: 'banner'
    }
  }
});
```

### 3. éªŒè¯å‰ç«¯åŠ è½½
åˆ·æ–°å›¾ç‰‡ç®¡ç†é¡µé¢ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä¿å­˜çš„å›¾ç‰‡ã€‚

## ğŸ“‹ æ•°æ®åº“ç»“æ„å¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆcloudImagesé›†åˆï¼‰
```javascript
{
  _id: "è‡ªåŠ¨ç”ŸæˆID",
  cloudPath: "images/banner/test.jpg",
  url: "https://...",
  fileName: "test.jpg",
  category: "banner",
  displayOrder: 1,
  createTime: "2025-09-07T...",
  updateTime: "2025-09-07T..."
}
```

### ä¿®æ”¹åï¼ˆimagesé›†åˆï¼‰
```javascript
{
  _id: "è‡ªåŠ¨ç”ŸæˆID",
  cloudPath: "images/banner/test.jpg",
  url: "https://...",
  fileName: "test.jpg",
  category: "banner",
  displayOrder: 1,
  createTime: "2025-09-07T...",
  updateTime: "2025-09-07T...",
  
  // å…¼å®¹å‰ç«¯å­—æ®µ
  sortOrder: 1,
  title: "test.jpg",
  imageUrl: "https://...",
  linkUrl: "",
  isActive: true
}
```

## ğŸ”§ å‰ç«¯å­—æ®µæ˜ å°„

| å‰ç«¯å­—æ®µ | äº‘å‡½æ•°å­—æ®µ | è¯´æ˜ |
|---------|-----------|------|
| `sortOrder` | `displayOrder` | æ˜¾ç¤ºé¡ºåº |
| `title` | `fileName` | å›¾ç‰‡æ ‡é¢˜ |
| `imageUrl` | `url` | å›¾ç‰‡URL |
| `linkUrl` | `linkUrl` | é“¾æ¥URL |
| `isActive` | `isActive` | æ˜¯å¦æ¿€æ´» |

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. ä¿å­˜æµ‹è¯•
```javascript
// ä¿å­˜è½®æ’­å›¾
const saveResult = await wx.cloud.callFunction({
  name: 'cloudStorageManager',
  data: {
    action: 'saveImageInfo',
    data: {
      images: [{
        cloudPath: 'images/banner/banner1.jpg',
        url: 'https://636c-cloudbase-3g4w6lls8a5ce59b-1327524326.tcb.qcloud.la/images/banner/banner1.jpg',
        fileName: 'banner1.jpg',
        category: 'banner',
        displayOrder: 1,
        title: 'é¦–é¡µè½®æ’­å›¾1',
        linkUrl: 'https://example.com'
      }],
      category: 'banner'
    }
  }
});
```

### 2. æŸ¥è¯¢æµ‹è¯•
```javascript
// æŸ¥è¯¢è½®æ’­å›¾
const queryResult = await wx.cloud.callFunction({
  name: 'cloudStorageManager',
  data: {
    action: 'getImageList',
    data: {
      category: 'banner'
    }
  }
});
```

### 3. å‰ç«¯éªŒè¯
- æ‰“å¼€å›¾ç‰‡ç®¡ç†é¡µé¢
- åˆ‡æ¢åˆ°"è½®æ’­å›¾"æ ‡ç­¾
- åº”è¯¥èƒ½çœ‹åˆ°ä¿å­˜çš„å›¾ç‰‡
- å›¾ç‰‡æ•°é‡åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æ•°å­—

## ğŸ“ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶æ— æ³•åŠ è½½ï¼š

1. **æ£€æŸ¥æ•°æ®åº“é›†åˆ**ï¼š
   - ç¡®è®¤ `images` é›†åˆå­˜åœ¨
   - ç¡®è®¤é›†åˆä¸­æœ‰æ•°æ®è®°å½•

2. **æ£€æŸ¥å‰ç«¯ä»£ç **ï¼š
   - ç¡®è®¤å‰ç«¯æŸ¥è¯¢çš„æ˜¯ `images` é›†åˆ
   - ç¡®è®¤æŸ¥è¯¢æ¡ä»¶æ­£ç¡®

3. **æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—**ï¼š
   - æŸ¥çœ‹äº‘å‡½æ•°æ‰§è¡Œæ—¥å¿—
   - ç¡®è®¤ä¿å­˜å’ŒæŸ¥è¯¢æ“ä½œæˆåŠŸ

4. **æ£€æŸ¥æƒé™é…ç½®**ï¼š
   - ç¡®è®¤æ•°æ®åº“æƒé™è®¾ç½®æ­£ç¡®
   - ç¡®è®¤ç”¨æˆ·æœ‰è¯»å–æƒé™

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®æ”¹å®Œæˆåï¼š
- âœ… å›¾ç‰‡ä¿å­˜åˆ° `images` é›†åˆ
- âœ… å‰ç«¯èƒ½æ­£ç¡®åŠ è½½å›¾ç‰‡
- âœ… å›¾ç‰‡ç®¡ç†ç•Œé¢æ˜¾ç¤ºæ­£ç¡®çš„æ•°é‡
- âœ… è½®æ’­å›¾åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

**é—®é¢˜çŠ¶æ€**: ğŸ”§ å·²è¯Šæ–­ï¼Œç­‰å¾…éƒ¨ç½²ä¿®å¤
**é¢„è®¡è§£å†³æ—¶é—´**: 5-10åˆ†é’Ÿ
**å½±å“èŒƒå›´**: å›¾ç‰‡ç®¡ç†åŠŸèƒ½
