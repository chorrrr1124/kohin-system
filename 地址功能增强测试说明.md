# 地址功能增强测试说明

## 📋 功能概述

在客户管理页面的新增客户和编辑客户功能中，已添加了完整的地址管理功能，包括省市区选择器和地址识别组件。

## ✅ 已实现功能

### 1. 省市区选择器组件 (AddressSelector)
- **三级联动选择**：省份 → 城市 → 区县
- **完整数据覆盖**：包含全国34个省级行政区、主要城市和区县
- **用户友好界面**：下拉选择器，支持搜索和快速选择
- **实时更新**：选择后立即更新地址信息

### 2. 地址识别组件 (AddressRecognizer)
- **智能识别**：输入完整地址，自动识别省市区和详细地址
- **多种格式支持**：支持"省市区详细地址"、"省市详细地址"、"省详细地址"等格式
- **正则表达式匹配**：使用多种模式匹配不同地址格式
- **智能解析**：当标准格式匹配失败时，使用智能识别算法
- **实时预览**：识别结果实时显示，支持应用和重新识别

### 3. 地址数据结构
```javascript
address: {
  province: '广东省',      // 省份
  city: '深圳市',         // 城市
  district: '南山区',      // 区县
  detail: '科技园南区深南大道10000号',  // 详细地址
  full: '广东省深圳市南山区科技园南区深南大道10000号'  // 完整地址
}
```

### 4. 界面功能
- **地址识别输入框**：输入完整地址进行智能识别
- **省市区选择器**：三级联动选择省市区
- **详细地址输入**：手动输入街道、门牌号等详细信息
- **完整地址预览**：实时显示拼接后的完整地址
- **兼容性处理**：支持旧格式地址数据的自动转换

## 🧪 测试步骤

### 测试环境
- 本地开发服务器：`http://localhost:5173`
- 访问路径：客户管理 → 新增客户 / 编辑客户

### 测试用例

#### 1. 地址识别功能测试

**测试用例 1.1：标准格式识别**
- **输入**：`广东省深圳市南山区科技园南区深南大道10000号`
- **预期结果**：
  - 省份：广东省
  - 城市：深圳市
  - 区县：南山区
  - 详细：科技园南区深南大道10000号

**测试用例 1.2：省市格式识别**
- **输入**：`北京市朝阳区三里屯街道`
- **预期结果**：
  - 省份：北京市
  - 城市：北京市
  - 区县：朝阳区
  - 详细：三里屯街道

**测试用例 1.3：智能识别**
- **输入**：`上海浦东新区陆家嘴金融贸易区`
- **预期结果**：自动识别出省份、城市、区县和详细地址

#### 2. 省市区选择器测试

**测试用例 2.1：三级联动选择**
- **步骤**：
  1. 点击省市区选择器
  2. 选择"广东省"
  3. 选择"深圳市"
  4. 选择"南山区"
- **预期结果**：显示"广东省 深圳市 南山区"

**测试用例 2.2：二级选择**
- **步骤**：
  1. 选择"北京市"
  2. 选择"北京市"
- **预期结果**：显示"北京市 北京市"

#### 3. 详细地址输入测试

**测试用例 3.1：详细地址输入**
- **步骤**：
  1. 选择省市区：广东省 深圳市 南山区
  2. 输入详细地址：科技园南区深南大道10000号
- **预期结果**：完整地址显示为"广东省 深圳市 南山区 科技园南区深南大道10000号"

#### 4. 完整功能集成测试

**测试用例 4.1：新增客户完整流程**
- **步骤**：
  1. 点击"新增客户"
  2. 填写客户基本信息
  3. 使用地址识别：输入"广东省深圳市南山区科技园南区深南大道10000号"
  4. 点击"识别地址"
  5. 点击"应用识别结果"
  6. 填写详细地址（如果需要）
  7. 点击"添加"
- **预期结果**：客户创建成功，地址信息正确保存

**测试用例 4.2：编辑客户地址更新**
- **步骤**：
  1. 点击现有客户的"编辑"按钮
  2. 修改地址信息
  3. 使用省市区选择器重新选择
  4. 更新详细地址
  5. 点击"保存"
- **预期结果**：地址信息更新成功

## 🔧 技术实现

### 1. 省市区选择器组件
```jsx
<AddressSelector
  value={selectedAddress}
  onChange={handleAddressChange}
  placeholder="请选择省市区"
/>
```

**特性**：
- 使用下拉选择器界面
- 三级联动数据加载
- 支持搜索和快速选择
- 响应式设计

### 2. 地址识别组件
```jsx
<AddressRecognizer 
  onRecognize={handleAddressRecognize}
  onClear={handleAddressClear}
/>
```

**特性**：
- 智能地址解析算法
- 多种格式模式匹配
- 实时识别结果预览
- 支持重新识别

### 3. 地址数据处理
```javascript
// 地址识别处理
const handleAddressRecognize = (index, recognizedData) => {
  const newContacts = [...customerForm.contacts];
  newContacts[index].address = {
    province: recognizedData.province || '',
    city: recognizedData.city || '',
    district: recognizedData.district || '',
    detail: recognizedData.detail || '',
    full: recognizedData.fullAddress || ''
  };
  setCustomerForm({ ...customerForm, contacts: newContacts });
};
```

### 4. 兼容性处理
```javascript
// 兼容旧格式地址数据
if (typeof contact.address === 'string') {
  return {
    ...contact,
    address: {
      province: '',
      city: '',
      district: '',
      detail: contact.address,
      full: contact.address
    }
  };
}
```

## 📱 支持的地址格式

### 识别格式
1. **完整格式**：`广东省深圳市南山区科技园南区深南大道10000号`
2. **省市格式**：`北京市朝阳区三里屯街道`
3. **省份格式**：`上海市浦东新区陆家嘴金融贸易区`
4. **智能识别**：`深圳南山区科技园`（自动补充省份）

### 选择器支持
- **34个省级行政区**：包括省、自治区、直辖市、特别行政区
- **主要城市**：覆盖全国主要地级市
- **区县数据**：包含主要城市的区县信息

## 🚀 使用方法

1. **启动开发服务器**
   ```bash
   cd web7.27/miniprogram-admin
   npm run dev
   ```

2. **访问客户管理页面**
   - 打开浏览器访问 `http://localhost:5173`
   - 点击"客户管理"菜单
   - 点击"+ 新增客户"按钮

3. **使用地址功能**
   - **方法一**：使用地址识别组件输入完整地址
   - **方法二**：使用省市区选择器逐级选择
   - **方法三**：结合使用两种方式

## 📝 注意事项

1. **数据兼容性**：新功能完全兼容旧格式的地址数据
2. **实时更新**：地址信息修改后立即更新完整地址预览
3. **错误处理**：识别失败时提供友好的错误提示
4. **用户体验**：提供多种输入方式，满足不同用户习惯
5. **数据完整性**：确保地址信息的完整性和准确性

## 🎯 功能亮点

- **智能识别**：支持多种地址格式的自动识别
- **三级联动**：完整的省市区选择器
- **实时预览**：地址信息实时显示和更新
- **兼容性强**：支持旧数据格式的自动转换
- **用户友好**：提供多种输入方式，操作简单直观

---

**功能状态**: ✅ 已完成  
**测试状态**: 🧪 待测试  
**部署状态**: ⏳ 本地测试中
