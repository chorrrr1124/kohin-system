# 🚀 Web端管理小程序布局系统 - 快速开始指南

## 📋 目录
- [功能概览](#功能概览)
- [环境准备](#环境准备)
- [快速部署](#快速部署)
- [基础配置](#基础配置)
- [第一个页面布局](#第一个页面布局)
- [常见问题](#常见问题)

---

## 🎯 功能概览

这套系统可以让您通过 Web 端后台**无需重新发布小程序**即可实现：

### 核心功能
- 🎨 **可视化布局编辑**：拖拽式组件编辑器
- 🔄 **实时配置更新**：WebSocket 实时推送配置变更
- 🎭 **主题管理**：统一的颜色、字体、样式管理
- 📱 **响应式预览**：实时预览小程序效果
- 📚 **组件库**：可扩展的组件库系统
- 🔄 **版本控制**：配置历史记录和回滚
- 👥 **权限管理**：多用户角色管理

### 支持的组件类型
- **轮播图 (Banner)**：多图轮播，支持自动播放
- **产品网格 (Product Grid)**：商品展示网格
- **文本组件 (Text)**：富文本内容展示
- **图片组件 (Image)**：单图展示
- **自定义组件**：可扩展更多组件类型

---

## 🛠️ 环境准备

### 系统要求
- **Node.js**: >= 16.0.0
- **npm**: >= 8.0.0
- **MongoDB**: >= 4.4
- **Redis**: >= 6.0 (可选)

### 推荐开发工具
- **微信开发者工具**: 最新版
- **VS Code**: 配合相关插件
- **Docker**: 用于快速部署

---

## 🚀 快速部署

### 方式一：Docker 一键部署 (推荐)

1. **克隆项目**
```bash
git clone https://github.com/your-repo/miniprogram-layout-cms.git
cd miniprogram-layout-cms
```

2. **配置环境变量**
```bash
# 复制环境变量模板
cp .env.example .env

# 编辑环境变量
nano .env
```

3. **启动服务**
```bash
# 生产环境
docker-compose up -d

# 开发环境
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

4. **访问管理界面**
- Web管理端: http://localhost:8080
- API文档: http://localhost:3000/api-docs
- 数据库管理: http://localhost:8082 (开发环境)

### 方式二：手动部署

1. **后端部署**
```bash
cd backend
npm install
cp .env.example .env
# 编辑 .env 文件配置数据库连接等
npm run build
npm start
```

2. **Web管理端部署**
```bash
cd web-admin
npm install
npm run build
# 部署 dist 目录到 Web 服务器
```

3. **小程序端配置**
```bash
cd miniprogram
# 在微信开发者工具中打开项目
# 配置云开发环境
# 修改 services/configService.js 中的 baseUrl
```

---

## ⚙️ 基础配置

### 1. 数据库初始化

首次部署后，系统会自动创建必要的数据库集合和初始数据：

```javascript
// 初始数据包括：
{
  // 默认主题
  themes: [默认主题配置],
  
  // 组件库
  component_library: [轮播图, 产品网格, 文本, 图片],
  
  // 示例页面配置
  page_configs: [首页, 产品页示例]
}
```

### 2. 小程序端配置

在小程序的 `services/configService.js` 中配置 API 地址：

```javascript
class ConfigService {
  constructor() {
    this.baseUrl = 'https://your-api-domain.com/api'; // 修改为您的API地址
  }
}
```

### 3. 域名配置

在微信公众平台配置服务器域名：
- **request合法域名**: `https://your-api-domain.com`
- **socket合法域名**: `wss://your-websocket-domain.com`
- **uploadFile合法域名**: `https://your-api-domain.com`

---

## 🎨 第一个页面布局

### 步骤1：登录管理后台

1. 访问 http://localhost:8080
2. 使用默认账号登录：
   - 用户名: `admin`
   - 密码: `admin123`

### 步骤2：创建页面

1. 点击 **"页面管理"** 菜单
2. 点击 **"新建页面"** 按钮
3. 填写页面信息：
   ```
   页面名称: 我的首页
   页面路径: pages/index/index
   选择主题: 默认主题
   ```

### 步骤3：编辑布局

1. 进入 **"布局编辑器"**
2. 从左侧组件面板拖拽组件到画布
3. 配置组件属性：

#### 添加轮播图
```javascript
// 轮播图配置示例
{
  images: [
    "https://example.com/banner1.jpg",
    "https://example.com/banner2.jpg"
  ],
  autoplay: true,
  duration: 3000,
  indicatorDots: true
}
```

#### 添加产品网格
```javascript
// 产品网格配置示例
{
  columns: 2,
  showPrice: true,
  showStock: false,
  products: [
    {
      id: "1",
      name: "珍珠奶茶",
      price: 12.00,
      image: "https://example.com/product1.jpg"
    }
  ]
}
```

### 步骤4：预览和发布

1. 点击 **"预览"** 查看效果
2. 确认无误后点击 **"发布"**
3. 小程序端将自动获取最新配置

### 步骤5：小程序端验证

在小程序中访问对应页面，验证布局是否正确显示。

---

## 🔧 高级配置

### 自定义主题

1. 进入 **"主题管理"**
2. 创建新主题或编辑现有主题
3. 配置颜色方案：
```javascript
{
  colors: {
    primary: "#FF6B6B",      // 主色调
    secondary: "#4ECDC4",    // 辅助色
    text_primary: "#2C3E50", // 主文本色
    background: "#FFFFFF"    // 背景色
  }
}
```

### 添加自定义组件

1. **后端注册组件**
```javascript
// models/Component.js
{
  component_type: "custom_card",
  component_name: "自定义卡片",
  default_config: {
    title: "默认标题",
    content: "默认内容"
  }
}
```

2. **Web端添加编辑器**
```vue
<!-- CustomCardEditor.vue -->
<template>
  <div>
    <el-input v-model="config.title" placeholder="卡片标题" />
    <el-input v-model="config.content" type="textarea" placeholder="卡片内容" />
  </div>
</template>
```

3. **小程序端实现渲染**
```xml
<!-- custom-card组件 -->
<view class="custom-card">
  <text class="title">{{config.title}}</text>
  <text class="content">{{config.content}}</text>
</view>
```

---

## 📊 监控和分析

### 查看使用统计

```bash
# API调用统计
curl http://localhost:3000/api/stats

# 缓存使用情况
curl http://localhost:3000/api/cache/stats

# 系统健康检查
curl http://localhost:3000/api/health
```

### 日志查看

```bash
# 查看API服务日志
docker logs miniprogram-api

# 查看Web服务日志
docker logs miniprogram-admin

# 查看数据库日志
docker logs miniprogram-mongodb
```

---

## 🐛 常见问题

### Q1: 小程序无法获取配置

**可能原因：**
- API地址配置错误
- 域名未在微信公众平台配置
- 网络连接问题

**解决方法：**
```javascript
// 1. 检查configService.js中的baseUrl配置
this.baseUrl = 'https://your-correct-api-domain.com/api';

// 2. 检查网络请求是否成功
console.log('API请求结果:', result);

// 3. 使用默认配置作为后备
return this.getDefaultConfig(pageId);
```

### Q2: 布局编辑器拖拽不生效

**可能原因：**
- 浏览器不支持某些API
- 组件库未正确加载

**解决方法：**
```javascript
// 检查浏览器兼容性
if (!window.DragEvent) {
  console.error('浏览器不支持拖拽API');
}

// 强制刷新组件库
this.$store.dispatch('components/fetchComponents');
```

### Q3: 配置更新不实时

**可能原因：**
- WebSocket连接失败
- 缓存未正确清除

**解决方法：**
```javascript
// 检查WebSocket连接状态
console.log('WebSocket状态:', this.isSocketConnected);

// 手动清除缓存
configService.clearAllCache();

// 强制刷新配置
await this.refreshConfig({ force: true });
```

### Q4: 图片上传失败

**可能原因：**
- 文件大小超限
- 文件格式不支持
- 存储空间不足

**解决方法：**
```javascript
// 检查文件大小 (10MB限制)
if (file.size > 10 * 1024 * 1024) {
  console.error('文件大小超过10MB限制');
}

// 检查文件格式
const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
if (!allowedTypes.includes(file.type)) {
  console.error('不支持的文件格式');
}
```

---

## 📞 技术支持

### 获取帮助
- 📖 **详细文档**: [查看完整开发文档](./Web端管理小程序布局系统开发文档.md)
- 🐛 **问题反馈**: 提交 GitHub Issue
- 💬 **技术交流**: 加入微信技术群

### 联系方式
- **邮箱**: tech-support@example.com
- **微信**: your_wechat_id
- **QQ群**: 123456789

---

## 🎉 快速开始完成！

恭喜！您已经成功搭建了Web端管理小程序布局系统。现在您可以：

1. ✅ 通过Web后台可视化编辑小程序页面布局
2. ✅ 实时预览和发布配置变更
3. ✅ 管理主题和组件库
4. ✅ 监控系统运行状态

下一步建议：
- 🔍 深入了解[完整开发文档](./Web端管理小程序布局系统开发文档.md)
- 🎨 自定义主题和组件
- 📊 配置监控和分析
- 🚀 部署到生产环境

**祝您使用愉快！** 🎊 