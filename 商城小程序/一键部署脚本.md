# 商城小程序一键部署脚本

## 使用微信开发者工具快速部署

### 第一步：打开项目
1. 打开微信开发者工具
2. 导入项目：选择 `商城小程序` 文件夹
3. 确认AppID和云开发环境配置正确

### 第二步：批量部署云函数

**方法一：逐个部署（推荐新手）**

按以下顺序右键每个云函数文件夹，选择「上传并部署：云端安装依赖」：

```
优先级1（核心功能，必须部署）：
✅ cloudfunctions/login
✅ cloudfunctions/syncUser  
✅ cloudfunctions/getShopProducts

优先级2（商城功能）：
✅ cloudfunctions/getProductDetail
✅ cloudfunctions/getBanners
✅ cloudfunctions/getCategories
✅ cloudfunctions/submitOrder
✅ cloudfunctions/getUserOrders

优先级3（购物车和优惠券）：
✅ cloudfunctions/getUserCart
✅ cloudfunctions/updateUserCart
✅ cloudfunctions/getActiveCoupons
✅ cloudfunctions/claimCoupon
✅ cloudfunctions/getUserCouponCount

优先级4（管理功能）：
✅ cloudfunctions/updateOrderStatus
✅ cloudfunctions/manageBanners
✅ cloudfunctions/manageHomepageConfig
✅ cloudfunctions/cleanupImageUrls
```

**方法二：使用云开发CLI（适合有经验的开发者）**

在PowerShell中执行：

```powershell
# 安装CLI工具（如果未安装）
npm install -g @cloudbase/cli

# 登录腾讯云
tcb login

# 进入项目目录
cd "C:\Users\chor\Desktop\code\finish\商城小程序"

# 批量部署核心云函数
tcb functions:deploy login
tcb functions:deploy syncUser
tcb functions:deploy getShopProducts
tcb functions:deploy getProductDetail
tcb functions:deploy getBanners
tcb functions:deploy getCategories
tcb functions:deploy submitOrder
tcb functions:deploy getUserOrders
tcb functions:deploy getUserCart
tcb functions:deploy updateUserCart
tcb functions:deploy getActiveCoupons
tcb functions:deploy claimCoupon
```

### 第三步：初始化测试数据

1. 在微信开发者工具中打开调试器控制台
2. 复制粘贴 `测试数据初始化.js` 文件中的代码
3. 执行初始化脚本：

```javascript
// 复制这段代码到控制台执行
console.log('开始初始化测试数据...');
initShopProducts();
initBanners();
initCategories();
console.log('测试数据初始化完成！');
```

### 第四步：验证部署结果

**检查云函数状态：**
1. 点击微信开发者工具的「云开发」按钮
2. 进入「云函数」页面
3. 确认所有函数状态为「正常」

**检查数据库：**
1. 进入「数据库」页面
2. 确认存在以下集合：
   - `shopProducts`（商品数据）
   - `banners`（轮播图）
   - `categories`（分类）
   - `users`（用户）
   - `orders`（订单）

**测试商城功能：**
1. 在小程序中导航到商品列表页面
2. 检查商品是否正常显示
3. 测试搜索、筛选功能
4. 测试加入购物车功能

## 常见部署问题解决

### 问题1：云函数部署失败
**错误信息：** `部署失败` 或 `网络错误`

**解决方案：**
```
1. 检查网络连接
2. 重试部署操作
3. 确认腾讯云账号权限
4. 检查云开发环境是否正常
```

### 问题2：商品数据不显示
**错误信息：** 商品列表为空或加载失败

**解决方案：**
```
1. 确认 getShopProducts 云函数已部署
2. 检查 shopProducts 数据库集合是否存在
3. 运行测试数据初始化脚本
4. 检查数据库权限设置
```

### 问题3：图片不显示
**错误信息：** 图片显示为占位符

**解决方案：**
```
1. 确认 image-placeholder 组件已注册
2. 检查图片路径是否正确
3. 验证图片文件是否存在
4. 这是正常现象，测试数据使用占位图
```

### 问题4：登录功能异常
**错误信息：** `FunctionName parameter could not be found`

**解决方案：**
```
1. 确认 login 和 syncUser 云函数已部署
2. 检查云开发环境ID配置
3. 验证小程序AppID设置
4. 清除小程序缓存重新编译
```

## 部署成功标志

当您看到以下情况时，说明部署成功：

✅ **云函数状态**
- 所有必需云函数显示「正常」状态
- 云函数调用无错误日志

✅ **商城页面**
- 商品列表正常显示
- 搜索和筛选功能正常
- 商品详情页面正常

✅ **购物车功能**
- 能够添加商品到购物车
- 购物车数量显示正确
- 购物车页面正常显示

✅ **用户功能**
- 登录功能正常
- 用户信息正确显示
- 订单功能正常

## 性能优化建议

部署完成后，建议进行以下优化：

1. **数据库索引优化**
   - 为商品表的 `category` 字段创建索引
   - 为订单表的 `userId` 字段创建索引

2. **图片资源优化**
   - 上传真实商品图片到云存储
   - 配置CDN加速

3. **缓存策略**
   - 启用商品数据缓存
   - 配置轮播图缓存

4. **监控告警**
   - 设置云函数调用量监控
   - 配置数据库性能监控

---

**部署完成后，您的商城小程序就可以正常使用了！**

如有问题，请参考 `部署云函数指南.md` 获取更详细的说明。