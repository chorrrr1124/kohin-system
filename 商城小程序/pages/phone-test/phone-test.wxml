<!--手机号测试页面-->
<view class="container">
  <view class="header">
    <text class="title">手机号获取测试</text>
    <text class="subtitle">测试微信手机号快速登录功能</text>
  </view>

  <view class="test-section">
    <view class="section-title">测试步骤</view>
    <view class="step-list">
      <view class="step-item">
        <text class="step-number">1</text>
        <text class="step-text">点击下方按钮获取手机号</text>
      </view>
      <view class="step-item">
        <text class="step-number">2</text>
        <text class="step-text">授权微信获取手机号</text>
      </view>
      <view class="step-item">
        <text class="step-number">3</text>
        <text class="step-text">查看获取结果</text>
      </view>
    </view>
  </view>

  <view class="action-section">
    <button 
      class="get-phone-btn"
      open-type="getPhoneNumber"
      bindgetphonenumber="onGetPhoneNumber"
      loading="{{loading}}"
      disabled="{{loading || isInCooldown}}"
    >
      {{loading ? '获取中...' : isInCooldown ? '请稍候...' : '获取手机号'}}
    </button>
    
    <!-- 冷却时间提示 -->
    <view wx:if="{{isInCooldown}}" class="cooldown-tip">
      请等待 {{cooldownRemaining}} 秒后重试
    </view>

    <!-- 诊断按钮 -->
    <button 
      class="diagnosis-btn"
      bindtap="runPhoneDiagnosis"
      loading="{{loading}}"
      disabled="{{loading}}"
    >
      运行手机号诊断
    </button>

    <!-- 手动输入按钮 -->
    <button 
      class="manual-input-btn"
      bindtap="goToManualInput"
    >
      手动输入手机号
    </button>

    <!-- 提示信息 -->
    <view class="tips-section">
      <view class="tips-title">💡 使用说明</view>
      <view class="tips-content">
        <view class="tip-item">• 如果自动获取手机号失败，请使用"手动输入手机号"</view>
        <view class="tip-item">• 手动输入支持手机号+验证码登录</view>
        <view class="tip-item">• 验证码将发送到您输入的手机号</view>
      </view>
    </view>
  </view>

  <view class="result-section" wx:if="{{result}}">
    <view class="section-title">获取结果</view>
    <view class="result-card">
      <view class="result-item">
        <text class="label">状态:</text>
        <text class="value {{result.success ? 'success' : 'error'}}">
          {{result.success ? '成功' : '失败'}}
        </text>
      </view>
      
      <view class="result-item" wx:if="{{result.phoneNumber}}">
        <text class="label">手机号:</text>
        <text class="value">{{result.phoneNumber}}</text>
      </view>
      
      <view class="result-item" wx:if="{{result.countryCode}}">
        <text class="label">国家代码:</text>
        <text class="value">+{{result.countryCode}}</text>
      </view>
      
      <view class="result-item" wx:if="{{result.maskedPhone}}">
        <text class="label">脱敏手机号:</text>
        <text class="value">{{result.maskedPhone}}</text>
      </view>
      
      <view class="result-item" wx:if="{{result.error}}">
        <text class="label">错误信息:</text>
        <text class="value error">{{result.error}}</text>
      </view>
      
      <view class="result-item" wx:if="{{result.detail}}">
        <text class="label">详细信息:</text>
        <text class="value detail">{{result.detail}}</text>
      </view>
    </view>
  </view>

  <view class="info-section">
    <view class="section-title">功能说明</view>
    <view class="info-list">
      <view class="info-item">
        <text class="info-icon">ℹ️</text>
        <text class="info-text">此功能需要用户授权获取手机号</text>
      </view>
      <view class="info-item">
        <text class="info-icon">🔒</text>
        <text class="info-text">手机号信息经过加密传输，安全可靠</text>
      </view>
      <view class="info-item">
        <text class="info-icon">⚡</text>
        <text class="info-text">支持快速登录，无需手动输入</text>
      </view>
    </view>
  </view>

  <!-- 诊断结果弹窗 -->
  <view wx:if="{{showDiagnosis}}" class="diagnosis-modal">
    <view class="diagnosis-content">
      <view class="diagnosis-header">
        <text class="diagnosis-title">手机号获取诊断结果</text>
        <text class="diagnosis-close" bindtap="hideDiagnosis">×</text>
      </view>
      
      <view class="diagnosis-body">
        <view wx:if="{{diagnosisResult.success}}" class="diagnosis-summary">
          <view class="summary-item">
            <text class="summary-label">检查项目:</text>
            <text class="summary-value">{{diagnosisResult.summary.totalChecks}} 项</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">通过:</text>
            <text class="summary-value success">{{diagnosisResult.summary.passedChecks}} 项</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">问题:</text>
            <text class="summary-value error">{{diagnosisResult.summary.failedChecks}} 项</text>
          </view>
        </view>

        <view wx:if="{{diagnosisResult.issues.length > 0}}" class="diagnosis-issues">
          <view class="issues-title">发现的问题:</view>
          <view wx:for="{{diagnosisResult.issues}}" wx:key="index" class="issue-item">
            <text class="issue-icon">❌</text>
            <text class="issue-text">{{item}}</text>
          </view>
        </view>

        <view wx:if="{{diagnosisResult.suggestions.length > 0}}" class="diagnosis-suggestions">
          <view class="suggestions-title">解决建议:</view>
          <view wx:for="{{diagnosisResult.suggestions}}" wx:key="index" class="suggestion-item">
            <text class="suggestion-icon">💡</text>
            <text class="suggestion-text">{{item}}</text>
          </view>
        </view>

        <view wx:if="{{!diagnosisResult.success}}" class="diagnosis-error">
          <text class="error-text">{{diagnosisResult.error}}</text>
        </view>
      </view>
    </view>
  </view>
</view> 