<!-- pages/coupon/coupon.wxml -->
<view class="coupon-container">
  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view class="error-state" wx:elif="{{hasError}}">
    <image-placeholder type="default" custom-class="error-image" src="/images/placeholder.svg" mode="aspectFit"></image-placeholder>
    <text class="error-text">{{errorMessage}}</text>
    <button class="retry-btn" bindtap="onRetry">重试</button>
  </view>

  <!-- 优惠券列表 -->
  <view class="coupon-list" wx:elif="{{coupons.length > 0}}">
    <block wx:for="{{coupons}}" wx:key="id" wx:for-index="index">
      <view class="coupon-item {{item.isUsed ? 'used' : ''}}">
        <view class="coupon-main">
          <view class="coupon-left">
            <view class="coupon-value">
              <text class="value">{{item.value}}</text>
              <text class="unit">{{item.unit}}</text>
            </view>
            <view class="coupon-condition">{{item.condition}}</view>
          </view>
          <view class="coupon-right">
            <view class="coupon-title">{{item.title}}</view>
            <view class="coupon-validity">{{item.validity}}</view>
          </view>
        </view>
        <!-- 操作按钮区域 -->
        <view class="action-buttons">
          <button class="rules-toggle" bindtap="toggleRules" data-index="{{index}}">
            使用规则 {{item.rulesExpanded ? '▲' : '▼'}}
          </button>
          <view class="button-group">
            <button class="coupon-btn share-btn" bindtap="shareCoupon" data-index="{{index}}">
              送好友
            </button>
            <button class="coupon-btn use-btn" bindtap="useCoupon" data-index="{{index}}">
              去使用
            </button>
          </view>
        </view>
        <view class="rules-details {{item.rulesExpanded ? 'expanded' : ''}}">
          <block wx:for="{{item.rules}}" wx:key="*this" wx:for-item="rule">
            <view class="rule-item">{{rule}}</view>
          </block>
        </view>
        <view class="used-stamp" wx:if="{{item.isUsed}}">已使用</view>
      </view>
    </block>
  </view>

  <!-- 空状态提示 -->
  <view class="empty-state" wx:elif="{{!loading && !hasError && coupons.length === 0}}">
    <image-placeholder type="default" custom-class="empty-image" src="/images/placeholder.svg" mode="aspectFit"></image-placeholder>
    <text class="empty-text">暂无优惠券</text>
    <view class="get-coupon-btn" bindtap="onGetCoupon">
      <text>去领券</text>
    </view>
  </view>
</view>