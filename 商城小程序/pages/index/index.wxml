<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- 渐变轮播图区域 -->
  <view class="carousel-section" style="height: 100vh;">
    <gradient-carousel 
      id="main-carousel"
      images="{{carouselImages}}" 
      height="100vh"
      autoplay="{{false}}"
      interval="{{10000}}"
      duration="{{1200}}"
      circular="{{true}}"
      showIndicators="{{false}}"
      bindchange="onCarouselChange"
      bindloaded="onCarouselLoaded"
    >
      <!-- 轮播图内容 -->
      <view class="carousel-content-overlay" style="padding-top: {{statusBarHeight}}px;">
        <!-- 顶部导航区域 -->
        <view class="promo-header">
        </view>
        
        <!-- 主推广轮播图区域 -->
        <view class="floating-promo-carousel">
          <swiper
            id="promo-swiper"
            class="promo-swiper"
            style="height: {{400}}rpx;"
            autoplay="{{true}}"
            interval="{{10000}}"
            duration="{{300}}"
            circular="{{true}}"
            current="{{promoSwiperCurrent}}"
            bindchange="onPromoSwiperChange"
          >
            <swiper-item wx:for="{{promoSwiperImages}}" wx:key="index">
              <image 
                src="{{item}}" 
                mode="aspectFill" 
                class="promo-swiper-image"
                style="width: 100%; height: 100%;"
              />
            </swiper-item>
          </swiper>
        </view>
        
        <!-- 悬浮用户信息卡片 -->
        <view class="floating-card-container">
          <floating-user-card 
            userInfo="{{userInfo}}"
            bindserviceSelect="onServiceSelect"
            bindfunctionSelect="onFunctionSelect"
          />
        </view>
      </view>
    </gradient-carousel>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">

    
    <!-- 推荐商品 -->
    <view class="recommend-section" wx:if="{{recommendProducts.length > 0}}">
      <view class="section-title">
        <text class="title-text">为你推荐</text>
      </view>
      
      <view class="product-grid">
        <block wx:for="{{recommendProducts}}" wx:key="_id" wx:for-index="index">
          <view 
            class="product-card" 
            bindtap="onProductTap" 
            data-id="{{item._id}}"
            wx:if="{{index < 6}}"
          >
            <image-placeholder 
              src="{{item.image}}" 
              type="product"
              custom-class="product-image"
              mode="aspectFill"
              lazy-load="true"
              bind:imageerror="onImageError"
              data-index="{{index}}"
            />
            <view class="product-info">
              <text class="product-name">{{item.name}}</text>
              <view class="product-footer">
                <view class="price-container">
                  <text class="product-price">￥{{item.price}}</text>
                </view>
                <view class="add-cart-btn" catchtap="onAddToCart" data-item="{{item}}">
                  <text>+</text>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
  

  
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 测试按钮（开发环境显示） -->
  <view class="test-buttons" wx:if="{{isDev}}">
    <button class="test-btn" bindtap="showTestMenu" size="mini" type="primary">测试首次启动</button>
  </view>

  <!-- 登录弹窗系统 -->
  <login-popup-system
    show-privacy-popup="{{showPrivacyPopup}}"
    show-benefit-popup="{{showBenefitPopup}}"
    show-phone-popup="{{showPhonePopup}}"
    masked-phone="{{maskedPhone}}"
    bind:privacyAgree="onPrivacyAgree"
    bind:privacyReject="onPrivacyReject"
    bind:benefitLogin="onBenefitLogin"
    bind:benefitSkip="onBenefitSkip"
    bind:phoneAllow="onPhoneAllow"
    bind:phoneReject="onPhoneReject"
    bind:useOtherPhone="onUseOtherPhone"
    bind:flowComplete="onFlowComplete"
    bind:phoneNumberGet="onPhoneNumberGet"
    bind:phoneNumberReject="onPhoneNumberReject"
  />

</view>