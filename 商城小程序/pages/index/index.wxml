<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- Ê∏êÂèòËΩÆÊí≠ÂõæÂå∫Âüü -->
  <view class="carousel-section" style="height: 100vh;">
    <gradient-carousel 
      id="main-carousel"
      images="{{carouselImages}}" 
      height="100vh"
      autoplay="{{false}}"
      interval="{{10000}}"
      duration="{{1200}}"
      circular="{{true}}"
      showIndicators="{{false}}"
      bindchange="onCarouselChange"
      bindloaded="onCarouselLoaded"
    >
      <!-- ËΩÆÊí≠ÂõæÂÜÖÂÆπ -->
      <view class="carousel-content-overlay" style="padding-top: {{statusBarHeight}}px;">
        <!-- È°∂ÈÉ®ÂØºËà™Âå∫Âüü -->
        <view class="promo-header">
        </view>
        
        <!-- ‰∏ªÊé®ÂπøËΩÆÊí≠ÂõæÂå∫Âüü -->
        <view class="floating-promo-carousel">
          <swiper
            id="promo-swiper"
            class="promo-swiper"
            style="height: {{400}}rpx;"
            autoplay="{{true}}"
            interval="{{10000}}"
            duration="{{300}}"
            circular="{{true}}"
            current="{{promoSwiperCurrent}}"
            bindchange="onPromoSwiperChange"
          >
            <swiper-item wx:for="{{promoSwiperImages}}" wx:key="index">
              <responsive-image 
                src="{{item}}" 
                mode="centerCrop"
                placeholder-type="banner"
                custom-class="promo-swiper-image"
                size-type="rectangle"
                show-actions="{{false}}"
                style="width: 100%; height: 100%;"
              />
            </swiper-item>
          </swiper>
        </view>
        
        <!-- ÊÇ¨ÊµÆÁî®Êà∑‰ø°ÊÅØÂç°Áâá -->
        <view class="floating-card-container">
          <floating-user-card 
            userInfo="{{userInfo}}"
            bindserviceSelect="onServiceSelect"
            bindfunctionSelect="onFunctionSelect"
          />
        </view>
      </view>
    </gradient-carousel>
  </view>

  <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
  <view class="main-content">

    <!-- Ë∞ÉËØïÊåâÈíÆÂå∫Âüü -->
    <view class="debug-section">
      <view class="debug-button" bindtap="onDebugTap">
        <text class="debug-text">üêõ Ë∞ÉËØïÂ∑•ÂÖ∑</text>
      </view>
    </view>
    
    <!-- Êé®ËçêÂïÜÂìÅ -->
    <view class="recommend-section" wx:if="{{recommendProducts.length > 0}}">
      <view class="section-title">
        <text class="title-text">‰∏∫‰Ω†Êé®Ëçê</text>
      </view>
      
      <view class="product-grid">
        <block wx:for="{{recommendProducts}}" wx:key="_id" wx:for-index="index">
          <view 
            class="product-card" 
            bindtap="onProductTap" 
            data-id="{{item._id}}"
            wx:if="{{index < 6}}"
          >
            <image-placeholder 
              src="{{item.image}}" 
              type="product"
              custom-class="product-image"
              mode="aspectFill"
              lazy-load="true"
              bind:imageerror="onImageError"
              data-index="{{index}}"
            />
            <view class="product-info">
              <text class="product-name">{{item.name}}</text>
              <view class="product-footer">
                <view class="price-container">
                  <text class="product-price">Ôø•{{item.price}}</text>
                </view>
                <view class="add-cart-btn" catchtap="onAddToCart" data-item="{{item}}">
                  <text>+</text>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
  

  
  <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
  <view class="loading" wx:if="{{loading}}">
    <text>Âä†ËΩΩ‰∏≠...</text>
  </view>


  <!-- ÁôªÂΩïÂºπÁ™óÁ≥ªÁªü -->
  <login-popup-system
    show-privacy-popup="{{showPrivacyPopup}}"
    show-benefit-popup="{{showBenefitPopup}}"
    show-phone-popup="{{showPhonePopup}}"
    masked-phone="{{maskedPhone}}"
    bind:privacyAgree="onPrivacyAgree"
    bind:privacyReject="onPrivacyReject"
    bind:benefitLogin="onBenefitLogin"
    bind:benefitSkip="onBenefitSkip"
    bind:phoneAllow="onPhoneAllow"
    bind:phoneReject="onPhoneReject"
    bind:useOtherPhone="onUseOtherPhone"
    bind:flowComplete="onFlowComplete"
    bind:phoneNumberGet="onPhoneNumberGet"
    bind:phoneNumberReject="onPhoneNumberReject"
  />

</view>