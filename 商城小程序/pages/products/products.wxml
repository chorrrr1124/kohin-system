<!--pages/products/products.wxml-->
<view class="page-container">
  <!-- 顶部Banner -->
  <view class="banner-container">
    <image 
      class="banner-image" 
      src="/images/banner/products-banner.svg" 
      mode="aspectFill"
    />
    <view class="banner-overlay">
      <text class="banner-title">精选好物</text>
      <text class="banner-subtitle">品质生活，从这里开始</text>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-container">
      <input 
        class="search-input" 
        placeholder="搜索商品" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view class="search-btn" bindtap="onSearchConfirm">
        <text class="iconfont icon-search">🔍</text>
      </view>
    </view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 左侧分类栏 -->
    <view class="sidebar">
      <view class="category-tabs">
        <block wx:for="{{categories}}" wx:key="id">
          <view 
            class="category-tab {{activeCategory === item.id ? 'active' : ''}}"
            bindtap="onCategoryTap"
            data-category="{{item.id}}"
          >
            {{item.name}}
          </view>
        </block>
      </view>
    </view>

    <!-- 右侧内容区域 -->
    <view class="content-area">
      <!-- 筛选栏 -->
      <view class="filter-bar">
        <view class="filter-tabs">
          <!-- 品牌选项卡 -->
          <scroll-view class="brand-tabs-horizontal" scroll-x="true">
            <block wx:for="{{brands}}" wx:key="id">
              <view 
                class="filter-tab brand-tab {{activeBrand === item.id ? 'active' : ''}}"
                bindtap="onBrandTap"
                data-brand="{{item.id}}"
              >
                {{item.name}}
              </view>
            </block>
          </scroll-view>
          

        </view>
      </view>

      <!-- 商品列表 -->
      <view class="products-container">
        <view class="products-list">
          <block wx:for="{{(searchKeyword || activeCategory !== 'all' || activeBrand !== 'all') ? filteredProducts : products}}" wx:key="_id">
            <view 
              class="product-list-item" 
              bindtap="onProductTap" 
              data-id="{{item._id}}"
            >
              <view class="product-image-container">
                <image-placeholder 
                  src="{{item.image}}" 
                  type="product"
                  custom-class="product-list-image"
                  custom-style="width: 104rpx; height: 104rpx;"
                  mode="aspectFill"
                  lazy-load="true"
                  bind:imageerror="onImageError"
                  data-id="{{item._id}}"
                  data-index="{{index}}"
                />
                
                <!-- 商品标签 -->
                <view class="product-tags" wx:if="{{item.tags && item.tags.length > 0}}">
                  <block wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
                    <view class="product-tag">{{tag}}</view>
                  </block>
                </view>
              </view>
              
              <view class="product-list-info">
                <view class="product-name">{{item.productName}}</view>
                <view class="product-spec" wx:if="{{item.specification}}">
                  {{item.specification}}
                </view>
                
                <view class="product-price-row">
                  <view class="price-container">
                    <text class="product-price">¥{{item.currentPrice || item.price}}</text>
                    <text 
                      class="product-original-price" 
                      wx:if="{{item.originalPrice && item.originalPrice > (item.currentPrice || item.price)}}"
                    >
                      ¥{{item.originalPrice}}
                    </text>
                  </view>
                  
                  <view class="product-actions">
                    <view 
                      class="add-cart-btn {{item.stock <= 0 ? 'disabled' : ''}}"
                      catchtap="onAddToCart"
                      data-id="{{item._id}}"
                    >
                      {{item.stock <= 0 ? '缺货' : '加购物车'}}
                    </view>
                  </view>
                </view>
                
                <!-- 价格下方的文本区域 -->
                <view class="product-extra-text" wx:if="{{item.extraText}}">
                  <text>{{item.extraText}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
        
        <!-- 加载状态 -->
        <view class="loading" wx:if="{{loading}}">
          <text>加载中...</text>
        </view>

        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{!loading && hasMore}}" bindtap="loadMoreProducts">
          <text>加载更多</text>
        </view>

        <!-- 没有更多 -->
        <view class="no-more" wx:if="{{!loading && !hasMore && products.length > 0}}">
          <text>这里是最底部</text>
        </view>

        <!-- 空状态 -->
        <view class="empty" wx:if="{{!loading && products.length === 0}}">
          <view class="empty-icon">📦</view>
          <text>{{searchKeyword ? '没有找到相关商品' : '暂无商品'}}</text>
          <view class="empty-btn" bindtap="onBackToHome" wx:if="{{searchKeyword}}">
            返回首页
          </view>
        </view>
      </view>
    </view>
  </view>
</view>