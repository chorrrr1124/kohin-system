<!--pages/products/products.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨Banner -->
  <view class="banner-container">
    <image 
      class="banner-image" 
      src="/images/banner/products-banner.svg" 
      mode="aspectFill"
    />
    <view class="banner-overlay">
      <text class="banner-title">ç²¾é€‰å¥½ç‰©</text>
      <text class="banner-subtitle">å“è´¨ç”Ÿæ´»ï¼Œä»è¿™é‡Œå¼€å§‹</text>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-container">
      <input 
        class="search-input" 
        placeholder="æœç´¢å•†å“" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view class="search-btn" bindtap="onSearchConfirm">
        <text class="iconfont icon-search">ğŸ”</text>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»æ  -->
    <view class="sidebar">
      <view class="category-tabs">
        <block wx:for="{{categories}}" wx:key="id">
          <view 
            class="category-tab {{activeCategory === item.id ? 'active' : ''}}"
            bindtap="onCategoryTap"
            data-category="{{item.id}}"
          >
            {{item.name}}
          </view>
        </block>
      </view>
    </view>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <view class="content-area">
      <!-- ç­›é€‰æ  -->
      <view class="filter-bar">
        <view class="filter-tabs">
          <!-- å“ç‰Œé€‰é¡¹å¡ -->
          <scroll-view class="brand-tabs-horizontal" scroll-x="true">
            <block wx:for="{{brands}}" wx:key="id">
              <view 
                class="filter-tab brand-tab {{activeBrand === item.id ? 'active' : ''}}"
                bindtap="onBrandTap"
                data-brand="{{item.id}}"
              >
                {{item.name}}
              </view>
            </block>
          </scroll-view>
          

        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="products-container">
        <view class="products-list">
          <block wx:for="{{(searchKeyword || activeCategory !== 'all' || activeBrand !== 'all') ? filteredProducts : products}}" wx:key="_id">
            <view 
              class="product-list-item" 
              bindtap="onProductTap" 
              data-id="{{item._id}}"
            >
              <view class="product-image-container">
                <image-placeholder 
                  src="{{item.image}}" 
                  type="product"
                  custom-class="product-list-image"
                  custom-style="width: 104rpx; height: 104rpx;"
                  mode="aspectFill"
                  lazy-load="true"
                  bind:imageerror="onImageError"
                  data-id="{{item._id}}"
                  data-index="{{index}}"
                />
                
                <!-- å•†å“æ ‡ç­¾ -->
                <view class="product-tags" wx:if="{{item.tags && item.tags.length > 0}}">
                  <block wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
                    <view class="product-tag">{{tag}}</view>
                  </block>
                </view>
              </view>
              
              <view class="product-list-info">
                <view class="product-name">{{item.productName}}</view>
                <view class="product-spec" wx:if="{{item.specification}}">
                  {{item.specification}}
                </view>
                
                <view class="product-price-row">
                  <view class="price-container">
                    <text class="product-price">Â¥{{item.currentPrice || item.price}}</text>
                    <text 
                      class="product-original-price" 
                      wx:if="{{item.originalPrice && item.originalPrice > (item.currentPrice || item.price)}}"
                    >
                      Â¥{{item.originalPrice}}
                    </text>
                  </view>
                  
                  <view class="product-actions">
                    <view 
                      class="add-cart-btn {{item.stock <= 0 ? 'disabled' : ''}}"
                      catchtap="onAddToCart"
                      data-id="{{item._id}}"
                    >
                      {{item.stock <= 0 ? 'ç¼ºè´§' : 'åŠ è´­ç‰©è½¦'}}
                    </view>
                  </view>
                </view>
                
                <!-- ä»·æ ¼ä¸‹æ–¹çš„æ–‡æœ¬åŒºåŸŸ -->
                <view class="product-extra-text" wx:if="{{item.extraText}}">
                  <text>{{item.extraText}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading" wx:if="{{loading}}">
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" wx:if="{{!loading && hasMore}}" bindtap="loadMoreProducts">
          <text>åŠ è½½æ›´å¤š</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!loading && !hasMore && products.length > 0}}">
          <text>è¿™é‡Œæ˜¯æœ€åº•éƒ¨</text>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty" wx:if="{{!loading && products.length === 0}}">
          <view class="empty-icon">ğŸ“¦</view>
          <text>{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“' : 'æš‚æ— å•†å“'}}</text>
          <view class="empty-btn" bindtap="onBackToHome" wx:if="{{searchKeyword}}">
            è¿”å›é¦–é¡µ
          </view>
        </view>
      </view>
    </view>
  </view>
</view>