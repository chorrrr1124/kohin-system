<!--pages/cart/cart.wxml-->
<view class="cart-container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">加载中...</view>
  </view>

  <!-- 购物车为空 -->
  <view wx:elif="{{isEmpty}}" class="empty-cart">
    <image-placeholder type="default" custom-class="empty-icon" src="/images/empty-cart.svg" mode="aspectFit"></image-placeholder>
    <text class="empty-text">购物车空空如也</text>
    <text class="empty-desc">快去挑选心仪的商品吧</text>
    <button class="continue-shopping-btn" bindtap="continueShopping">去购物</button>
  </view>

  <!-- 购物车有商品 -->
  <view wx:else class="cart-content">
    <!-- 购物车头部 -->
    <view class="cart-header">
      <text class="cart-title">购物车</text>
      <text class="cart-count">({{cartItems.length}}件商品)</text>
      <text class="clear-cart" bindtap="clearCart">清空</text>
    </view>

    <!-- 商品列表 -->
    <scroll-view class="cart-list" scroll-y="true">
      <view class="cart-item" wx:for="{{cartItems}}" wx:key="_id" wx:for-index="index">
        <!-- 选择框 -->
        <view class="item-checkbox" bindtap="toggleSelection" data-index="{{index}}">
          <icon type="{{item.selected !== false ? 'success' : 'circle'}}" size="20" color="{{item.selected !== false ? '#07c160' : '#c9c9c9'}}"></icon>
        </view>

        <!-- 商品图片 -->
        <image-placeholder type="product" custom-class="item-image" src="{{item.image}}" mode="aspectFill"></image-placeholder>

        <!-- 商品信息 -->
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-desc">{{item.description}}</text>
          <view class="item-price-row">
            <text class="item-price">¥{{item.price}}</text>
            <text class="item-stock">库存{{item.stock || 999}}</text>
          </view>
        </view>

        <!-- 数量控制 -->
        <view class="quantity-control">
          <view class="quantity-btn decrease" bindtap="decreaseQuantity" data-index="{{index}}">
            <text class="btn-text">-</text>
          </view>
          <text class="quantity-text">{{item.quantity}}</text>
          <view class="quantity-btn increase" bindtap="increaseQuantity" data-index="{{index}}">
            <text class="btn-text">+</text>
          </view>
        </view>

        <!-- 删除按钮 -->
        <view class="item-delete" bindtap="removeItem" data-index="{{index}}">
          <icon type="clear" size="20" color="#999"></icon>
        </view>
      </view>
    </scroll-view>

    <!-- 底部结算栏 -->
    <view class="cart-footer">
      <view class="total-info">
        <text class="total-label">合计：</text>
        <text class="total-price">¥{{totalPrice}}</text>
      </view>
      <button class="checkout-btn" bindtap="goToCheckout">去结算</button>
    </view>
  </view>
</view>