# 🚀 云函数部署指南

## 📋 部署步骤

### 1. 部署所有云函数

在微信开发者工具中：

1. **打开云开发控制台**
   - 点击工具栏的"云开发"按钮
   - 或访问：https://console.cloud.tencent.com/tcb

2. **部署云函数**
   - 在左侧菜单选择"云函数"
   - 确保以下云函数已部署：
     - ✅ `decryptPhoneNumber` - 手机号解密
     - ✅ `sendSmsCode` - 发送验证码
     - ✅ `verifySmsCode` - 验证验证码

### 2. 手动部署方法

#### 方法1：通过开发者工具
```
1. 在微信开发者工具中
2. 找到 cloudfunctions 目录
3. 右键点击每个云函数文件夹
4. 选择"上传并部署：云端安装依赖"
5. 等待部署完成
```

#### 方法2：通过云开发控制台
```
1. 访问云开发控制台
2. 选择"云函数"
3. 点击"新建云函数"
4. 上传云函数代码
5. 安装依赖包
```

### 3. 验证部署

部署完成后，运行诊断工具检查：

```javascript
// 在开发环境中
// 选择"运行诊断"
// 检查云函数测试结果
```

## 🔧 常见问题解决

### 问题1：云函数未找到
**错误信息**：`FunctionName parameter could not be found`

**解决方案**：
1. 确保云函数已正确部署
2. 检查云函数名称拼写
3. 重新部署云函数

### 问题2：依赖包缺失
**错误信息**：`Cannot find module 'wx-server-sdk'`

**解决方案**：
1. 在云函数目录下运行 `npm install`
2. 选择"云端安装依赖"选项
3. 重新部署云函数

### 问题3：环境ID问题
**错误信息**：`环境ID: undefined`

**解决方案**：
1. 检查 app.js 中的环境ID配置
2. 确保云开发环境已创建
3. 验证环境ID是否正确

## 📱 测试步骤

### 1. 基础测试
```javascript
// 测试云函数连接
wx.cloud.callFunction({
  name: 'decryptPhoneNumber',
  data: { test: true }
}).then(res => {
  console.log('云函数测试成功:', res);
}).catch(err => {
  console.error('云函数测试失败:', err);
});
```

### 2. 完整流程测试
1. 点击"获取手机号"
2. 如果失败，选择"运行诊断"
3. 查看诊断结果
4. 根据结果修复问题

## 🎯 预期结果

部署成功后，诊断结果应该显示：

```
✅ 系统环境正常
✅ 云开发环境正常
环境ID: cloudbase-3g4w6lls8a5ce59b
✅ getPhoneNumber: 可用（真机测试）
✅ 云开发: 正常
✅ 云函数: 正常

云函数测试:
✅ decryptPhoneNumber: 成功
✅ sendSmsCode: 成功
✅ verifySmsCode: 成功
```

## 📞 技术支持

如果部署后仍有问题：

1. **检查云开发控制台日志**
2. **查看云函数调用记录**
3. **确认环境ID配置**
4. **验证云函数权限设置**

---

**部署状态**: 待部署  
**最后更新**: 2024年1月17日 