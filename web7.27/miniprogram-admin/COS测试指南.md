# 🧪 COS图片上传功能测试指南

## 📋 测试准备

### 1. 环境信息
- **环境ID**: `cloudbase-3g4w6lls8a5ce59b`
- **COS存储桶**: `kohin-1327524326`
- **COS地域**: `ap-guangzhou`
- **云函数**: `getCosSts`

### 2. 测试文件
- **完整测试页面**: `test-cos-upload.html`
- **简单测试页面**: `test-cos-simple.html`

## 🚀 测试步骤

### 方法一：使用简单测试页面

1. **打开测试页面**
   ```bash
   # 在浏览器中打开
   open test-cos-simple.html
   ```

2. **按步骤测试**
   - 输入环境ID: `cloudbase-3g4w6lls8a5ce59b`
   - 点击"初始化"
   - 点击"匿名登录"
   - 点击"测试getCosSts"

### 方法二：使用完整测试页面

1. **打开完整测试页面**
   ```bash
   # 在浏览器中打开
   open test-cos-upload.html
   ```

2. **完整功能测试**
   - 环境配置和登录
   - 云函数测试
   - 图片上传测试
   - 查看上传结果

### 方法三：使用Web管理后台

1. **启动服务器**
   ```bash
   npm run dev
   ```

2. **访问管理后台**
   - 打开浏览器访问: http://localhost:5173/
   - 导航到"图片管理"页面
   - 测试图片上传功能

## 🔍 测试检查点

### ✅ 环境初始化
- [ ] 环境ID正确
- [ ] CloudBase SDK加载成功
- [ ] 初始化无错误

### ✅ 用户认证
- [ ] 匿名登录成功
- [ ] 登录状态正确
- [ ] 用户ID获取成功

### ✅ 云函数调用
- [ ] getCosSts云函数存在
- [ ] 云函数调用成功
- [ ] 返回临时密钥
- [ ] 密钥格式正确

### ✅ COS上传
- [ ] COS客户端创建成功
- [ ] 文件上传成功
- [ ] 返回访问URL
- [ ] 图片可以正常访问

## 🐛 常见问题排查

### 1. 环境初始化失败
```javascript
// 检查环境ID是否正确
const envId = 'cloudbase-3g4w6lls8a5ce59b';
```

### 2. 登录失败
```javascript
// 检查是否已初始化
if (!app) {
    console.error('请先初始化环境');
    return;
}
```

### 3. 云函数调用失败
```javascript
// 检查云函数是否存在
// 检查网络连接
// 检查环境权限
```

### 4. COS上传失败
```javascript
// 检查临时密钥
// 检查存储桶配置
// 检查文件格式和大小
```

## 📊 测试结果示例

### 成功示例
```
[14:30:15] 环境初始化成功: cloudbase-3g4w6lls8a5ce59b
[14:30:16] 匿名登录成功
[14:30:17] 获取COS临时密钥成功
[14:30:18] 文件上传完成: test.jpg
[14:30:19] 访问URL: https://kohin-1327524326.cos.ap-guangzhou.myqcloud.com/images/general/1234567890_abc123.jpg
```

### 失败示例
```
[14:30:15] 环境初始化失败: Invalid environment ID
[14:30:16] 登录失败: Network error
[14:30:17] 获取COS临时密钥失败: Function not found
```

## 🔧 调试技巧

1. **查看浏览器控制台**
   - 打开开发者工具
   - 查看Console标签
   - 检查错误信息

2. **查看网络请求**
   - 打开Network标签
   - 查看API调用
   - 检查响应状态

3. **使用日志功能**
   - 测试页面有详细日志
   - 记录每个步骤
   - 便于问题定位

## 📝 测试报告模板

```
测试时间: 2024-XX-XX XX:XX:XX
测试环境: cloudbase-3g4w6lls8a5ce59b
测试人员: [姓名]

测试结果:
✅ 环境初始化: 成功/失败
✅ 用户登录: 成功/失败  
✅ 云函数调用: 成功/失败
✅ 图片上传: 成功/失败

问题记录:
- [问题描述]
- [解决方案]

建议:
- [改进建议]
```

## 🎯 下一步

测试完成后，可以：
1. 部署到生产环境
2. 集成到小程序
3. 优化上传体验
4. 添加更多功能
