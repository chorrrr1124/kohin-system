# 智能地址识别功能测试说明

## 📋 功能概述

重新设计的地址识别功能现在支持多行输入，能够智能识别收货人姓名、联系电话和地址信息，并自动填充到对应的表单字段中。

## ✅ 核心功能

### 1. 多行输入识别
- **输入方式**：支持多行文本输入
- **识别内容**：姓名、电话、地址信息
- **智能解析**：自动识别并分类不同信息

### 2. 智能识别算法
- **姓名识别**：识别2-4个非数字字符作为姓名
- **电话识别**：支持手机号、座机号、400电话等多种格式
- **地址识别**：支持省市区详细地址的完整解析

### 3. 自动填充功能
- **姓名填充**：自动填充到联系人姓名字段
- **电话填充**：自动填充到联系电话字段
- **地址填充**：自动填充省市区选择器和详细地址字段

## 🧪 测试用例

### 测试环境
- 本地开发服务器：`http://localhost:5173`
- 访问路径：客户管理 → 新增客户 / 编辑客户

### 测试用例 1：标准多行格式

**输入内容**：
```
张三
13800138000
广东省深圳市南山区科技园南区深南大道10000号
```

**预期结果**：
- 收货人：张三
- 联系电话：13800138000
- 省份：广东省
- 城市：深圳市
- 区县：南山区
- 详细地址：科技园南区深南大道10000号

### 测试用例 2：单行格式

**输入内容**：
```
张三 13800138000 广东省深圳市南山区科技园南区深南大道10000号
```

**预期结果**：
- 收货人：张三
- 联系电话：13800138000
- 省份：广东省
- 城市：深圳市
- 区县：南山区
- 详细地址：科技园南区深南大道10000号

### 测试用例 3：带逗号分隔

**输入内容**：
```
张三，13800138000，广东省深圳市南山区科技园南区深南大道10000号
```

**预期结果**：
- 收货人：张三
- 联系电话：13800138000
- 省份：广东省
- 城市：深圳市
- 区县：南山区
- 详细地址：科技园南区深南大道10000号

### 测试用例 4：复杂地址格式

**输入内容**：
```
李四
13912345678
北京市朝阳区三里屯街道工体北路8号
```

**预期结果**：
- 收货人：李四
- 联系电话：13912345678
- 省份：北京市
- 城市：北京市
- 区县：朝阳区
- 详细地址：三里屯街道工体北路8号

### 测试用例 5：座机号码

**输入内容**：
```
王五
010-12345678
上海市浦东新区陆家嘴金融贸易区
```

**预期结果**：
- 收货人：王五
- 联系电话：010-12345678
- 省份：上海市
- 城市：上海市
- 区县：浦东新区
- 详细地址：陆家嘴金融贸易区

## 🔧 技术实现

### 1. 姓名识别算法
```javascript
const namePatterns = [
  /^([^\d\s]{2,4})\s/,  // 开头2-4个非数字非空格字符
  /^([^\d\s]{2,4})[\s\n]/,  // 开头2-4个非数字非空格字符，后跟空格或换行
  /^([^\d\s]{2,4})[，,]\s*/,  // 开头2-4个非数字非空格字符，后跟逗号
];
```

### 2. 电话识别算法
```javascript
const phonePatterns = [
  /1[3-9]\d{9}/g,  // 手机号
  /0\d{2,3}-?\d{7,8}/g,  // 座机号
  /400-?\d{3}-?\d{4}/g,  // 400电话
  /\(\d{3,4}\)\d{7,8}/g,  // 带区号的座机
];
```

### 3. 地址识别算法
```javascript
const addressPatterns = [
  // 完整格式：省市区详细地址
  /^(.{2,4}?[省市])(.{2,4}?[市])(.{2,4}?[区县])(.+)$/,
  // 省市格式：省市详细地址
  /^(.{2,4}?[省市])(.{2,4}?[市])(.+)$/,
  // 省份格式：省详细地址
  /^(.{2,4}?[省市])(.+)$/,
];
```

### 4. 自动填充机制
```javascript
const handleAddressRecognize = (index, recognizedData) => {
  const newContacts = [...customerForm.contacts];
  
  // 更新联系人信息
  if (recognizedData.name) {
    newContacts[index].name = recognizedData.name;
  }
  if (recognizedData.phone) {
    newContacts[index].phone = recognizedData.phone;
  }
  
  // 更新地址信息
  newContacts[index].address = {
    province: recognizedData.province || '',
    city: recognizedData.city || '',
    district: recognizedData.district || '',
    detail: recognizedData.detail || '',
    full: recognizedData.fullAddress || recognizedData.address || ''
  };
  
  setCustomerForm({ ...customerForm, contacts: newContacts });
};
```

## 📱 界面功能

### 1. 多行输入框
- **类型**：textarea，支持多行输入
- **占位符**：提供示例格式
- **行数**：4行，可调整大小

### 2. 识别结果展示
- **网格布局**：2列网格展示识别结果
- **颜色区分**：不同信息用不同颜色标识
- **完整地址**：单独区域显示完整地址

### 3. 操作按钮
- **智能识别**：触发识别算法
- **应用识别结果**：将识别结果填充到表单
- **重新识别**：清空重新输入
- **清空**：清空输入框

## 🎯 功能亮点

### 1. 智能识别
- **多格式支持**：支持多种输入格式
- **容错性强**：识别失败时提供友好提示
- **实时预览**：识别结果实时显示

### 2. 自动填充
- **一键填充**：识别后一键填充所有字段
- **省市区联动**：自动选择对应的省市区
- **数据完整性**：确保所有信息正确填充

### 3. 用户体验
- **操作简单**：输入后点击识别即可
- **结果清晰**：识别结果一目了然
- **错误处理**：识别失败时提供明确提示

## 🚀 使用方法

1. **启动开发服务器**
   ```bash
   cd web7.27/miniprogram-admin
   npm run dev
   ```

2. **访问客户管理页面**
   - 打开浏览器访问 `http://localhost:5173`
   - 点击"客户管理"菜单
   - 点击"+ 新增客户"按钮

3. **使用智能识别功能**
   - 在"智能识别收货信息"区域输入多行信息
   - 点击"智能识别"按钮
   - 查看识别结果
   - 点击"应用识别结果"自动填充表单

## 📝 注意事项

1. **输入格式**：建议使用多行格式，每行一个信息
2. **姓名识别**：姓名应为2-4个字符，不包含数字
3. **电话识别**：支持手机号、座机号等多种格式
4. **地址识别**：地址应包含省份或城市信息
5. **数据验证**：应用前会进行数据验证

## 🔍 故障排除

### 常见问题

1. **识别失败**
   - 检查输入格式是否正确
   - 确保包含必要的地址信息
   - 尝试重新输入

2. **填充不完整**
   - 检查识别结果是否完整
   - 手动补充缺失信息
   - 重新识别

3. **省市区选择器不更新**
   - 检查地址格式是否正确
   - 确保省份和城市名称准确
   - 手动选择省市区

---

**功能状态**: ✅ 已完成  
**测试状态**: 🧪 待测试  
**部署状态**: ⏳ 本地测试中
